---
title: DFSR에서 분산 파일 잠금 이해 (결여)
description: 이 문서에서는 Windows에 다중 호스트 분산 파일 잠금 메커니즘이 없고 특히 DFSR에서 복제 된 폴더 내에 있는 경우를 설명 합니다.
ms.prod: windows-server
ms.technology: server-general
ms.date: 06/10/2020
author: Deland-Han
ms.author: delhan
ms.openlocfilehash: 739bcd1127877d4c9b1339b64270262d9d48634f
ms.sourcegitcommit: fa9a8badf4eb366aeeca7d2905e2cad711ee8dae
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 06/11/2020
ms.locfileid: "84714977"
---
# <a name="understanding-the-lack-of-distributed-file-locking-in-dfsr"></a>DFSR에서 분산 파일 잠금 이해 (결여)

이 문서에서는 Windows에 다중 호스트 분산 파일 잠금 메커니즘이 없고 특히 DFSR에서 복제 된 폴더 내에 있는 경우를 설명 합니다.
  
## <a name="some-background"></a>일부 배경

  - 분산 파일 잠금 – 여러 컴퓨터에 파일의 복사본을 여러 개 포함 하는 개념과 파일 하나를 쓰기용으로 연 경우 다른 모든 복사본이 잠깁니다. 이렇게 하면 여러 사용자가 동시에 파일을 여러 서버에서 수정할 수 없습니다.
  - 분산 파일 시스템 복제 – [DFSR](/previous-versions/windows/desktop/dfsr/distributed-file-system-replication--dfsr-) 은 다중 마스터 상태 기반 디자인에서 작동 합니다. 상태 기반 복제에서 다중 마스터 시스템의 각 서버는 로그 파일을 교환 하지 않고도 수신 되는 복제본에 업데이트를 적용 합니다. 대신 버전 벡터를 사용 하 여 "최신" 정보를 유지 관리 합니다. 초기 동기화 후에는 한 서버에 임의로 권한이 부여 되지 않으므로 다양 한 네트워크 토폴로지에서는 항상 사용 가능 하 고 유연 합니다.
  - 서버 메시지 블록- [SMB](/openspecs/windows_protocols/ms-smb/f210069c-7086-4dc2-885e-861d837df688) 는 Windows에서 네트워크를 통해 파일에 액세스 하는 데 사용 되는 일반적인 프로토콜입니다. 간단히 말해 리디렉터를 사용 하 여 원격 파일 시스템을 로컬 파일 시스템으로 표시 하는 클라이언트-서버 프로토콜입니다. Windows에 국한 되지 않으며 매우 일반적입니다. 잘 알려진 Microsoft 예제는 Samba로, Linux, Mac 및 기타 운영 체제가 SMB 클라이언트/서버 역할을 하 고 Windows 네트워크에 참여할 수 있도록 합니다.

  
복제 된 데이터 환경에서 DFSR 및 SMB가 있는 위치를 명확 하 게 경계 하는 것이 중요 합니다. SMB를 통해 사용자는 파일에 액세스할 수 있으며 DFSR은 인식 하지 못합니다. 마찬가지로, DFSR (RPC 프로토콜 사용)은 파일을 서버 간에 동기화 된 상태로 유지 하 고 SMB를 인식 하지 않습니다. 이 사후 [잠금 및 oplocks](/windows/win32/fileio/opportunistic-locks)에 정의 된 분산 잠금을 혼동 하지 마세요.  
  
여기에는 Brits와 같이 배 모양의 점이 있을 수 있습니다.  
  
사용자는 여러 서버에서 데이터를 수정할 수 있으며, 각 Windows 서버는 자체 파일 잠금에 대 한 *정보를* 알 수 없으므로, [DFSR은 다른 서버에서 해당 잠금에 대 한 정보를 알](/previous-versions/windows/it-pro/windows-server-2003/cc773238(v=ws.10))수 없으므로 사용자가 서로의 변경 내용을 덮어쓸 수 있습니다. DFSR은 "마지막 기록기 wins" 충돌 알고리즘을 사용 하므로 누군가가 손실을 방지 하 고 마지막으로 저장 하는 사람이 변경 내용을 유지 해야 합니다. 손실 되는 파일 복사본은 *ConflictAndDeleted* 폴더로 chucked 됩니다.  
  
이제 생각 하는 것 보다 훨씬 *더* 일반적이 지 않습니다. 일반적으로 실제 공유 파일은 로컬 환경에서 수정 됩니다. 지점 또는 큐비클의 같은 행에 있습니다. 일반적으로 동일한 팀의 사람들이 작업 하므로 사용자는 일반적으로 데이터를 수정 하는 동료를 인식 합니다. 그리고 일반적으로 동일한 사이트에 있기 때문에 공유 문서에서 작업 하는 모든 사용자가 동일한 서버를 사용 하는 것이 훨씬 더 높습니다. Windows SMB는 여기에서 상황을 처리 합니다. 사용자가 파일을 수정 하기 위해 잠 궜으 며 동료가 편집 하려고 하면 다른 사용자에 게 다음과 같은 오류가 표시 됩니다.  
  
![사용 중인 파일](./media/understanding-the-lack-of-distributed-file-locking-in-dfsr/1.jpg)
  
또한 파일을 여는 응용 프로그램의 경우 Word 2007와 같이 매우 영리 수 있는 경우 다음을 제공할 수 있습니다.  
  
![사용 중인 파일](./media/understanding-the-lack-of-distributed-file-locking-in-dfsr/2.jpg) 
  
DFSR에는 잠긴 파일에 대 한 메커니즘이 있지만 서버 자체 컨텍스트 내 에서만 사용할 수 있습니다. 로컬 복사본에 배타 잠금이 있는 경우 DFSR은 파일을 복제 하지 않습니다. 그러나 다른 서버에 있는 사용자가 파일을 수정 하지 못하게 하는 것은 아닙니다.  
  
다시 토픽에서 수정 되는 공유 데이터의 문제가 존재 하며, 일부 *사람들은 매우* gnarly. DFSR이이 잠금을 처리 하지 않고 매직 지팡이를 사용 하는 모든 작업을 수행 하는 이유를 묻는 경우가 있습니다. 이는 다중 마스터 복제 시스템에 대해 해결할 수 있는 흥미로운 시나리오입니다. 지금 살펴보세요.  
  
## <a name="third-party-solutions"></a>타사 솔루션
  
이 문제를 해결 하는 몇 가지 공급 업체 솔루션이 있습니다. 일반적으로 다음 방법 중 하나 이상을 수행 합니다 \* .  

  - Broker 메커니즘 사용

> Central ' traffic 복사 '를 사용 하면 한 서버에서 다른 모든 서버와 사용자가 잠근 파일을 인식할 수 있습니다. 그러나이는 분산 잠금 시스템에서 단일 실패 지점이 종종 있음을 의미 합니다.

![토폴로지](./media/understanding-the-lack-of-distributed-file-locking-in-dfsr/3.png) 

  - 완전히 라우팅된 네트워크에 대 한 요구 사항

> 중앙 브로커가 파일 복제에 참여 하는 모든 서버와 통신할 수 있어야 하므로 복잡 한 네트워크 토폴로지를 처리 하는 기능이 제거 됩니다. 일반적으로 링 토폴로지와 다중 허브 및 스포크 토폴로지는 가능 하지 않습니다. 완전히 라우팅되지 않은 네트워크에서 일부 서버는 서로 직접 연결 하지 못하거나 broker에 연결할 수 없으며, 다른 서버와 통신할 수 있는 파트너와만 통신할 수 있습니다. 이는 다중 마스터 환경에서는 문제가 없지만 중개 메커니즘에서는 문제가 없습니다.

![토폴로지](./media/understanding-the-lack-of-distributed-file-locking-in-dfsr/4.png)

  - 서버 쌍으로 제한 됩니다.

> 일부 솔루션은 분산 잠금 메커니즘을 간소화 하기 위해 토폴로지를 서버 쌍으로 제한 합니다. 대규모 환경의 경우에는이 방법이 적합 하지 않을 수 있습니다.

  - 클라이언트 및 서버에서 에이전트를 사용 합니다.
  - 다중 마스터 복제 사용 안 함
  - MS 클러스터링을 사용 하지 마십시오.
  - 전문 어플라이언스를 활용 합니다.

  
***\***\!이러한 메서드 중 하나 이상을 구현 하지 않는 솔루션이 있으므로 일반적으로는 죽음 위협을 게시 하지 마세요.\!*  
  
## <a name="deeper-thoughts"></a>더 깊은 생각  
  
이 문제에 대 한 자세한 내용은 일부 기본적인 문제를 해결 하기 시작 합니다. 예를 들어 4 개의 사이트에서 사용자가 수정할 수 있는 데이터를 포함 하는 4 대의 서버가 있고 이러한 서버 중 하나에 대 한 WAN 연결이 오프 라인 상태가 되 면 어떻게 해야 하나요? 사용자는 계속 해 서 개별 서버에 액세스할 수 있지만이를 허용 해야 합니다. 충돌 하는 변경 내용을 적용 하는 것을 원하지는 않지만 계속 해 서 작업 하 고 회사의 비용을 절감할 수 있습니다. 해당 시점에 임의로 변경을 차단 하는 경우 실제로 어떤 충돌도 발생 하지 않을 수 있지만 사용자가 작업을 수행할 수 없습니다.\! 다른 서버에 파일을 사용 하 고 있음을 다른 서버에 알릴 수 있는 방법은 없습니다.  
  
![토폴로지](./media/understanding-the-lack-of-distributed-file-locking-in-dfsr/5.png)
  
그러면 SMB 자체와 보고 잠금의 오류 처리가 발생 합니다. 응용 프로그램의 수와 클라이언트에서 새로운 확장 된 오류 메시지를 이해 하지 못하는 경우에도 SMB에서 공유 위반이 발생 하는 방식을 변경할 수 없습니다. Word 2007와 같은 응용 프로그램은 파일을 잠그는 사용자를 파악 하는 데 trickery를 포함 하지만 대부분의 응용 프로그램은 파일을 사용 하는 사용자 (또는 해당 SMB가 존재 함)를 알지 못합니다. 정말.). 따라서 사용자가 '이 파일이 사용 되 고 있습니다. ' 메시지를 사용 하는 경우에는 특별히 조치를 취할 수 없습니다. 모두 지원 센터에 문의 해야 하나요? 지원 센터에서 모든 파일 서버에 액세스 하 여 파일에 액세스 하는 사용자를 볼 수 있나요? 워.  
  
고가용성을 위해 다중 마스터가 필요 하므로 broker 시스템이 그다지 바람직하지 않습니다. 완전히 라우팅되지 않은 네트워크를 통해서도 통신할 수 있도록 모든 서버에서 실행 되는 항목이 필요할 수 있습니다. 이 경우 매우 복잡 한 동기화 기술이 필요 합니다. 네트워크에 약간의 오버 헤드가 추가 되 고 (그다지 많지 않은 경우), 사용자가 작업에 사용자를 보유 하 고 있지 않은지 확인 하기 위해 신속 하 게 번개를 해야 합니다. 파일 복제 자체를 수행 해야 합니다. 실제로 복제에 연결 해야 할 수도 있습니다. 또한 네트워크와 관련 되 고 서버가 충돌 하지 않는 서버 중단을 고려해 야 합니다.  

![토폴로지](./media/understanding-the-lack-of-distributed-file-locking-in-dfsr/6.png)
  
그런 다음 잠금을 보다 잘 이해 하 고 사용자에 게 유용한 정보를 제공할 수 있는이 시나리오에 대 한 특별 한 클라이언트 소프트웨어를 다시 제공 합니다. ("call call Susie in accounting and 해당 문서를 릴리스 하도록 지시 합니다." 라는 메시지가 표시 되 면 파일 잠금 토폴로지가 중단 되 고 관리자가 수정 될 때까지 파일을 열 수 없습니다. 이는 Windows에서 실행 되는 수백만 개의 응용 프로그램을 사용 하 여 원활 하 게 재생 하는 데 매우 흥미롭습니다. 지원 되지 않거나 소프트웨어를 다운로드할 수 있는 많은 OS가 있습니다. Windows 2000는 기본 지원 서비스를 제공 하지 않고 곧 제공 될 예정입니다. Linux 및 Mac 클라이언트는 중요 한 것으로 생각 될 때까지이 소프트웨어를 제공 하지 않으므로, 고객은 각자에 게 유사한 작업을 수행 하는 데 도움이 될 것입니다.  
  
## <a name="more-inforamtion"></a>추가 inforamtion
  
현재 DFSR에서 이러한 상황을 제어 하는 가장 쉬운 방법은 DFS 네임 스페이스를 사용 하 여 사용자에 게 일관 된 네임 스페이스를 가진 예측 가능한 위치를 안내 하는 것입니다. DFSN 사이트 토폴로지 및 서버 링크를 올바르게 구성 하면 모든 사용자가 동일한 로컬 서버를 공유 하 고 ' 주 ' 서버가 다운 된 경우에만 원격 컴퓨터에 액세스할 수 있도록 합니다. 대부분의 환경에서 매우 잘 작동 합니다. DFSR 대신 SharePoint는 체크 아웃/체크 인 시스템 때문에 옵션입니다. BranchCache (Windows Server 2008 R2 및 Windows 7에 제공 됨)는 분기 시나리오에서 파일 읽기를 용이 하 게 하기 위해 설계 되었기 때문에 사용자가 선택할 수 있는 옵션 일 수 있지만,이 경우에는 신뢰할 수 있는 데이터가 한 서버에만 남아 있습니다 .이에 대 한 자세한 내용은 [여기](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/jj127252(v=ws.11))를 참조 하세요. 또한 이러한 공급 업체에는 해당 솔루션이 있습니다.

