---
title: KMS 문제 해결 지침
description: KMS 서비스에 대한 정보를 제공하고, 정품 인증 문제를 해결하기 위한 도구와 방법을 제안합니다.
ms.topic: troubleshooting
ms.date: 9/24/2019
ms.technology: server-general
author: Teresa-Motiv
ms.author: v-tea
manager: dcscontentpm
ms.localizationpriority: medium
ms.openlocfilehash: dc84edaebda64d3ae359e17b683411ac479c9397
ms.sourcegitcommit: 771db070a3a924c8265944e21bf9bd85350dd93c
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 06/27/2020
ms.locfileid: "85473220"
---
# <a name="guidelines-for-troubleshooting-the-key-management-service-kms"></a>KMS(키 관리 서비스) 문제 해결 지침

대부분의 기업 고객은 배포 프로세스의 일환으로 해당 환경에서 Windows를 정품 인증할 수 있도록 KMS(키 관리 서비스)를 설정합니다. KMS 호스트를 설정하는 간단한 프로세스이며, KMS 클라이언트에서 호스트를 검색하여 자체적으로 정품 인증을 시도합니다. 그러나 해당 프로세스가 작동하지 않으면 어떻게 될까요? 그 다음에는 어떻게 해야 할까요? 이 문서에서는 문제를 해결하는 데 필요한 리소스를 살펴봅니다. 이벤트 로그 항목 및 Slmgr.vbs 스크립트에 대한 자세한 내용은 [볼륨 정품 인증 기술 참조](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dn502529(v=ws.11))를 참조하세요.

## <a name="kms-overview"></a>KMS 개요

먼저 KMS 정품 인증에 대한 빠른 리프레셔부터 살펴보겠습니다. KMS는 클라이언트-서버 모델입니다. 개념적으로는 DHCP와 비슷합니다. KMS는 해당 요청에 따라 IP 주소를 클라이언트에 전달하는 대신 제품 정품 인증을 사용하도록 설정합니다. 또한 KMS는 클라이언트에서 일정한 간격으로 정품 재인증을 시도하는 갱신 모델이기도 합니다. *KMS 호스트*와 *KMS 클라이언트*의 두 역할이 있습니다.

- **KMS 호스트**는 정품 인증 서비스를 실행하고, 환경에서 정품 인증을 사용하도록 설정합니다. KMS 호스트를 구성하려면 VLSC(볼륨 라이선스 서비스 센터)에서 KMS 키를 설치한 다음, 서비스를 정품 인증해야 합니다.
- **KMS 클라이언트**는 환경에 배포되어 정품 인증해야 하는 Windows 운영 체제입니다. KMS 클라이언트는 볼륨 정품 인증을 사용하는 모든 버전의 Windows를 실행할 수 있습니다. KMS 클라이언트에는 GVLK(일반 볼륨 라이선스 키) 또는 KMS 클라이언트 설정 키라는 미리 설치된 키가 제공됩니다. GVLK가 있으면 시스템에서 KMS 클라이언트를 사용하게 됩니다. KMS 클라이언트는 DNS SRV 레코드(_vlmcs._tcp)를 사용하여 KMS 호스트를 식별합니다. 그런 다음, 클라이언트에서 이 서비스를 자동으로 검색하여 자동으로 정품 인증합니다. 30일간의 기본 제공 유예 기간 동안 2시간마다 정품 인증을 시도합니다. 정품 인증 후에는 KMS 클라이언트에서 7일마다 정품 인증을 갱신하려고 시도합니다.

문제 해결의 관점에서 양쪽(호스트 및 클라이언트)을 자세히 살펴보고서 진행 상황을 확인해야 할 수도 있습니다.

## <a name="kms-host"></a>KMS 호스트

KMS 호스트에서 검사할 두 가지 영역이 있습니다. 먼저, 호스트 소프트웨어 라이선스 서비스의 상태를 확인합니다. 다음으로, 이벤트 뷰어에서 라이선스 또는 정품 인증과 관련된 이벤트가 있는지 확인합니다.

### <a name="slmgrvbs-and-the-software-licensing-service"></a>Slmgr.vbs 및 소프트웨어 라이선스 서비스

소프트웨어 라이선스 서비스의 자세한 정보 출력을 보려면, 관리자 권한으로 실행되는 명령 프롬프트 창을 열고 명령 프롬프트에서 **slmgr.vbs /dlv**를 입력합니다. 다음 스크린샷에서는 Microsoft 내 KMS 호스트 중 하나에 대한 이 명령의 결과를 보여 줍니다.

![KMS 호스트 Slmgr 출력](./media/ee939272.kms_slmgr_output(en-us,technet.10).png)

문제를 해결하는 데 가장 중요한 필드는 다음과 같습니다. 찾고 있는 항목은 해결해야 하는 문제에 따라 다를 수 있습니다.

- **버전 정보**. **slmgr.vbs /dlv** 출력의 맨 위에는 소프트웨어 라이선스 서비스 버전이 있습니다. 이 항목은 서비스의 현재 버전이 설치되어 있는지 여부를 확인하는 데 유용할 수 있습니다. 예를 들어 Windows Server 2003의 KMS 서비스 업데이트는 다른 KMS 호스트 키를 지원합니다. 이 데이터는 최신 버전인지 여부를 평가하는 데 사용할 수 있으며 설치하려는 KMS 호스트 키를 지원합니다. 이러한 업데이트에 대한 자세한 내용은 [Windows Vista 및 Windows Server 2008에서 Windows 7 및 Windows Server 2008 R2용 KMS 정품 인증 지원을 확장하는 업데이트를 사용할 수 있습니다.](https://support.microsoft.com/help/968912/an-update-is-available-for-windows-vista-and-for-windows-server-2008-t)를 참조하세요.
- **이름** - KMS 호스트 시스템에 설치된 Windows 버전을 나타냅니다. KMS 호스트 키를 추가하거나 변경하는 데 문제가 있는 경우 이 문제를 해결하는 데 중요할 수 있습니다(예: 해당 OS 버전에서 키가 지원되는지 확인).
- **설명**. 설치된 키가 표시되는 위치입니다. 이 필드를 사용하여 서비스를 정품 인증하는 데 사용된 키와 배포한 KMS 클라이언트에 적합한 키인지의 여부를 확인합니다.
- **라이선스 상태**. KMS 호스트 시스템의 상태입니다. 값은 **사용 허가됨**이어야 합니다. 다른 값은 무언가가 잘못되었으며 호스트를 다시 정품 인증해야 할 수 있음을 의미합니다.
- **현재 수**. 표시되는 개수는 **0**-**50**입니다. 개수는 누적되며(운영 체제 간), 30일 기간 내에 정품 인증하려고 시도한 유효한 시스템의 수를 나타냅니다.

  개수가 **0**이면 서비스가 최근에 정품 인증되었거나 유효한 클라이언트가 KMS 호스트에 연결되지 않았습니다.

  환경에 있는 유효한 시스템의 수에 관계 없이 개수는 **50** 이상으로 증가하지 않습니다. 이는 개수가 KMS 클라이언트에서 반환하는 최대 라이선스 정책의 두 배만 캐싱하도록 설정되어 있기 때문입니다. 현재 최대 정책은 Windows 클라이언트 OS에서 설정하며, 이 경우 KMS 호스트에서 자동으로 정품 인증하려면 **25** 이상의 개수가 필요합니다. 따라서 KMS 호스트에서 가장 높은 개수는 2x25 또는 50입니다. Windows Server KMS 클라이언트만 포함된 환경에서 KMS 호스트의 최대 개수는 **10**입니다. 이는 Windows Server 버전의 임계값이 **5**(2x5 또는 10)이기 때문입니다.

  개수와 관련된 일반적인 문제는 환경에 정품 인증된 KMS 호스트와 충분한 클라이언트가 있지만 개수가 하나를 초과하여 증가하지 않는 경우입니다. 핵심 문제는 배포된 클라이언트 이미지가 올바르게 구성되지 않았고(**sysprep /generalize**) 시스템에 고유한 CMID(클라이언트 머신 ID)가 없다는 것입니다. 자세한 내용은 [KMS 클라이언트](#kms-client) 및 [새 Windows Vista 또는 Windows 7 기반 클라이언트 컴퓨터를 네트워크에 추가하면 KMS 현재 수가 증가하지 않습니다.](https://support.microsoft.com/help/929829/the-kms-current-count-does-not-increase-when-you-add-new-windows-vista)를 참조하세요. 또한 지원 에스컬레이션 엔지니어 중 한 명이 이 문제와 관련하여 [중복된 CMID로 인해 KMS 호스트 클라이언트 수가 증가하지 않음](https://blogs.technet.microsoft.com/askcore/2009/10/16/kms-host-client-count-not-increasing-due-to-duplicate-cmids/)이라는 게시물을 블로그에 올렸습니다.

  개수가 증가하지 않는 또 다른 이유는 환경에 너무 많은 KMS 호스트가 있고 개수가 호스트 전체에 분산되어 있기 때문입니다.
- **수신 대기 포트**. KMS와의 통신에는 익명 RPC가 사용됩니다. 기본적으로 클라이언트는 1688 TCP 포트를 사용하여 KMS 호스트에 연결합니다. 이 포트가 KMS 클라이언트와 KMS 호스트 간에 열려 있는지 확인합니다. KMS 호스트에서 포트를 변경하거나 구성할 수 있습니다. 통신하는 동안 KMS 호스트는 포트 지정을 KMS 클라이언트에 보냅니다. KMS 클라이언트에서 포트를 변경하면 해당 클라이언트에서 호스트에 연결할 때 포트 지정을 덮어씁니다.

**slmgr.vbs /dlv** 출력의 "누적 요청 수" 섹션에 대한 질문을 받는 경우가 많습니다. 일반적으로 이 데이터는 문제를 해결하는 데 유용하지 않습니다. KMS 호스트는 정품 인증 또는 정품 재인증을 시도하는 각 KMS 클라이언트의 상태를 지속적으로 기록합니다. 실패한 요청은 KMS 호스트에서 지원하지 않는 KMS 클라이언트를 나타냅니다. 예를 들어 Windows 7 KMS 클라이언트에서 Windows Vista KMS 키를 사용하여 정품 인증된 KMS 호스트에 대해 정품 인증을 시도하면 정품 인증이 실패합니다. "라이선스 상태가 포함된 요청" 줄은 과거와 현재의 모든 가능한 라이선스 상태를 설명합니다. 문제 해결의 관점에서 이 데이터는 개수가 예상대로 증가하지 않는 경우에만 관련이 있습니다. 이 경우 실패한 요청 수가 증가할 수 있습니다. 이는 KMS 호스트 시스템을 정품 인증하는 데 사용된 제품 키를 확인해야 함을 나타냅니다. 또한 KMS 호스트 시스템을 다시 설치하는 경우에만 누적 요청 값이 다시 설정됩니다.

### <a name="useful-kms-host-events"></a>유용한 KMS 호스트 이벤트

#### <a name="event-id-12290"></a>12290 이벤트 ID

KMS 클라이언트에서 정품 인증하기 위해 호스트에 연결하는 경우 KMS 호스트는 12290 이벤트 ID를 기록합니다. 12290 이벤트 ID는 호스트에 연결된 클라이언트의 종류와 오류가 발생한 이유를 파악하는 데 사용할 수 있는 많은 양의 정보를 제공합니다. 12290 이벤트 ID 항목의 다음 세그먼트는 KMS 호스트의 키 관리 서비스 이벤트 로그에서 제공됩니다.

![KMS 12290 이벤트](./media/ee939272.kms_12290_event(en-us,technet.10).png)

이벤트 세부 정보에 포함되는 정보는 다음과 같습니다.

- **정품 인증에 필요한 최소 개수**. 정품 인증하려면 KMS 호스트의 개수가 **5**여야 한다고 KMS 클라이언트에서 보고합니다. 이는 특정 버전을 나타내지는 않지만 Windows Server OS임을 의미합니다. 클라이언트가 정품 인증되지 않으면 호스트에서 개수가 충분한지 확인합니다.
- **CMID(클라이언트 머신 ID)** . 각 시스템에 대한 고유한 값입니다. 이 값이 고유하지 않으면 이미지가 배포용으로 올바르게 준비되지 않았기 때문입니다(**sysprep /generalize**). 이 문제는 환경에 클라이언트가 충분하더라도 KMS 호스트에서 증가하지 않는 개수로 나타납니다. 자세한 내용은 [새 Windows Vista 또는 Windows 7 기반 클라이언트 컴퓨터를 네트워크에 추가하면 KMS 현재 수가 증가하지 않습니다.](https://support.microsoft.com/help/929829/the-kms-current-count-does-not-increase-when-you-add-new-windows-vista)를 참조하세요.
- **라이선스 상태 및 상태 만료 시간**. 클라이언트의 현재 라이선스 상태입니다. 이는 정품 인증을 처음 시도하는 클라이언트와 정품 인증을 다시 시도하는 클라이언트를 구분하는 데 도움이 될 수 있습니다. 시간 항목은 아무 것도 변경되지 않은 경우 클라이언트에서 해당 상태를 유지하는 데 남아 있는 기간을 알려줍니다.

클라이언트 문제를 해결하고 있고 KMS 호스트에서 해당 12290 이벤트 ID를 찾을 수 없으면 해당 클라이언트가 KMS 호스트에 연결되지 않습니다. 12290 이벤트 ID 항목이 없는 몇 가지 이유는 다음과 같습니다.

- 네트워크 가동 중지가 발생했습니다.
- 호스트가 확인되지 않거나 DNS에 등록되어 있지 않습니다.
- 방화벽에서 1688 TCP를 차단하고 있습니다.
   포트는 KMS 호스트 시스템 자체를 포함하여 환경 내의 여러 위치에서 차단될 수 있습니다. 기본적으로 KMS 호스트에는 KMS에 대한 방화벽 예외가 있지만 자동으로 사용하도록 설정되지는 않습니다. 이 경우 예외를 설정해야 합니다.
- 이벤트 로그가 꽉 찼습니다.

KMS 클라이언트는 두 개의 해당 이벤트(12288 및 12289 이벤트 ID)를 기록합니다. 이러한 이벤트에 대한 자세한 내용은 [KMS 클라이언트](#kms-client) 섹션을 참조하세요.

#### <a name="event-id-12293"></a>12293 이벤트 ID

KMS 호스트에서 찾아야 할 또 다른 관련 이벤트는 12293 이벤트 ID입니다. 이 이벤트는 호스트에서 필요한 레코드를 DNS에 게시하지 않았음을 나타냅니다. 이 상황은 오류를 발생시키는 것으로 알려져 있으며, 호스트를 설정한 *후* 및 클라이언트를 배포하기 *전*에 확인해야 합니다. DNS 문제에 대한 자세한 내용은 [KMS 및 DNS 문제에 대한 일반적인 문제 해결 절차](common-troubleshooting-procedures-kms-dns.md)를 참조하세요.

## <a name="kms-client"></a>KMS 클라이언트

클라이언트에서 동일한 도구(Slmgr 및 이벤트 뷰어)를 사용하여 정품 인증 문제를 해결합니다.

### <a name="slmgrvbs-and-the-software-licensing-service"></a>Slmgr.vbs 및 소프트웨어 라이선스 서비스

소프트웨어 라이선스 서비스의 자세한 정보 출력을 보려면, 관리자 권한으로 실행되는 명령 프롬프트 창을 열고 명령 프롬프트에서 **slmgr.vbs /dlv**를 입력합니다. 다음 스크린샷에서는 Microsoft 내 KMS 호스트 중 하나에 대한 이 명령의 결과를 보여 줍니다.

![KMS 클라이언트 Slmgr 출력](./media/ee939272.kms_client_slmgr_output(en-us,technet.10).png)

다음 목록에는 문제를 해결하는 데 가장 중요한 필드가 나와 있습니다. 찾고 있는 항목은 해결해야 하는 문제에 따라 다를 수 있습니다.

- **이름** - 이 값은 KMS 클라이언트 시스템에 설치된 Windows 버전입니다. 이 필드를 사용하여 정품 인증을 시도하는 Windows 버전에서 KMS를 사용할 수 있는지 확인합니다. 예를 들어 지원 센터에서 고객이 Windows Vista Ultimate와 같이 볼륨 정품 인증을 사용하지 않는 Windows 버전에 KMS 클라이언트 설정 키를 설치하려고 하는 경우를 보았습니다.
- **설명**. 이 값은 설치된 키를 나타냅니다. VOLUME_KMSCLIENT는 KMS 클라이언트 설정 키(또는 GVLK)가 설치되어 있고(볼륨 라이선스 미디어의 기본 구성), 이 시스템에서 KMS 호스트를 사용하여 자동으로 정품 인증을 시도한다는 것을 나타냅니다. 여기에 MAK와 같은 다른 항목이 표시되면 이 시스템을 KMS 클라이언트로 구성하기 위해 GVLK를 다시 설치해야 합니다. **slmgr.vbs /ipk &lt;*GVLK*&gt;** 를 사용하여 키를 수동으로 설치하거나([KMS 클라이언트 설정 키](kmsclientkeys.md)에서 설명한 대로), VAMT(볼륨 정품 인증 관리 도구)를 사용할 수 있습니다. VAMT를 가져오고 사용하는 방법에 대한 자세한 내용은 [VAMT(볼륨 정품 인증 관리 도구) 기술 참조](https://docs.microsoft.com/windows/deployment/volume-activation/volume-activation-management-tool)를 참조하세요.
- **부분 제품 키**. 이 정보를 **이름** 필드로 사용하여 이 컴퓨터에 올바른 KMS 클라이언트 설정 키가 설치되어 있는지 확인할 수 있습니다(즉, 키가 KMS 클라이언트에 설치된 운영 체제와 일치). 기본적으로 VLSC(볼륨 라이선스 서비스 센터) 포털의 미디어를 사용하여 작성된 시스템에는 올바른 키가 있습니다. 경우에 따라 고객은 환경에 KMS 정품 인증을 지원하는 데 충분한 시스템이 있을 때까지 MAK(복수 정품 인증 키) 정품 인증을 사용할 수 있습니다. 이러한 시스템을 MAK에서 KMS로 전환하려면 해당 시스템에 KMS 클라이언트 설정 키를 설치해야 합니다. VAMT를 사용하여 이 키를 설치하고 올바른 키가 적용되었는지 확인합니다.
- **라이선스 상태**. 이 값은 KMS 클라이언트 시스템의 상태를 나타냅니다. KMS를 사용하여 정품 인증된 시스템의 경우 이 값은 **사용 허가됨**이어야 합니다. 다른 값은 문제가 있음을 나타낼 수 있습니다. 예를 들어 KMS 호스트가 올바르게 작동하고 KMS 클라이언트에서 정품 인증하지 않는 경우(예: **유예** 상태로 유지됨), 방화벽 문제, 네트워크 가동 중지 또는 이와 비슷한 상황으로 인해 클라이언트에서 호스트 시스템에 도달하지 못할 수 있습니다.
- **CMID(클라이언트 머신 ID)** . 각 KMS 클라이언트에는 고유한 CMID가 있어야 합니다. [KMS 호스트](#kms-host) 섹션에 설명한 대로, 개수와 관련된 일반적인 문제는 환경에 정품 인증된 KMS 호스트와 충분한 클라이언트가 있지만 개수가 **1**을 초과하여 증가하지 않는 경우입니다. 자세한 내용은 [새 Windows Vista 또는 Windows 7 기반 클라이언트 컴퓨터를 네트워크에 추가하면 KMS 현재 수가 증가하지 않습니다.](https://support.microsoft.com/help/929829/the-kms-current-count-does-not-increase-when-you-add-new-windows-vista)를 참조하세요.
- **DNS의 KMS 머신 이름**. 이 값은 클라이언트가 정품 인증에 성공적으로 사용한 KMS 호스트의 FQDN과 통신에 사용한 TCP 포트를 나타냅니다.
- **KMS 호스트 캐싱**. 마지막 값은 캐싱 사용 여부를 나타냅니다. 기본적으로 사용하도록 설정됩니다. 즉 KMS 클라이언트에서 정품 인증에 사용한 KMS 호스트 이름을 캐시하고, 다시 정품 인증할 때 DNS를 쿼리하는 대신 이 호스트와 직접 통신합니다. 클라이언트에서 캐시된 KMS 호스트에 연결할 수 없으면 DNS를 쿼리하여 새 KMS 호스트를 검색합니다.

### <a name="useful-kms-client-events"></a>유용한 KMS 클라이언트 이벤트

#### <a name="event-id-12288-and-event-id-12289"></a>12288 및 12289 이벤트 ID

KMS 클라이언트에서 성공적으로 정품 인증하거나 다시 정품 인증하면 클라이언트는 12288 이벤트 ID와 12289 이벤트 ID의 두 이벤트를 기록합니다. 12288 이벤트 ID 항목의 다음 세그먼트는 KMS 클라이언트의 키 관리 서비스 이벤트 로그에서 제공됩니다.

![12288 KMS 클라이언트 이벤트 ID](./media/ee939272.client_12288(en-us,technet.10).png)

12288 이벤트 ID만(해당 12289 이벤트 ID 없이) 표시되면 KMS 클라이언트에서 KMS 호스트에 연결할 수 없거나, KMS 호스트에서 응답하지 않았거나, 클라이언트에서 응답을 받지 못했음을 의미합니다. 이 경우 KMS 호스트에서 검색 가능하고 KMS 클라이언트에서 KMS 호스트에 연결할 수 있는지 확인합니다.

12288 이벤트 ID에서 관련성이 가장 높은 정보는 정보 섹션의 데이터입니다. 예를 들어 이 섹션에서는 클라이언트의 현재 상태 및 클라이언트에서 정품 인증을 시도할 때 사용한 FQDN과 TCP 포트를 보여 줍니다. FQDN을 사용하여 KMS 호스트의 수가 증가하지 않는 경우의 문제를 해결할 수 있습니다. 예를 들어 클라이언트(합법적 시스템 또는 악성 시스템)에서 사용할 수 있는 KMS 호스트가 너무 많은 경우 개수가 호스트 전체에 분산될 수 있습니다.

정품 인증에 실패하는 경우 클라이언트에 항상 12289가 아니라 12288이 있다는 것을 의미하지는 않습니다. 정품 인증 또는 정품 재인증에 실패하는 경우에도 두 이벤트가 모두 발생할 수 있습니다. 이 경우 두 번째 이벤트를 검사하여 실패 이유를 확인해야 합니다.

![12289 KMS 클라이언트 이벤트 ID](./media/ee939272.client_12289(en-us,technet.10).png)

12289 이벤트 ID의 정보 섹션에서 제공하는 정보는 다음과 같습니다.

- **정품 인증 플래그**. 이 값은 정품 인증에 성공했는지(**1**), 아니면 실패했는지(**0**)를 나타냅니다.
- **KMS 호스트의 현재 수**. 이 값은 클라이언트에서 정품 인증을 시도할 때 KMS 호스트의 개수 값을 반영합니다. 정품 인증에 실패하는 경우 이 클라이언트 OS에 대한 개수가 부족하거나 환경에 개수를 작성할 시스템이 부족하기 때문일 수 있습니다.

## <a name="what-does-support-ask-for"></a>지원에서 요청하는 것은 무엇인가요?

지원 서비스에 문의하여 정품 인증 문제를 해결해야 하는 경우 지원 엔지니어가 일반적으로 요청하는 정보는 다음과 같습니다.

- KMS 호스트 및 KMS 클라이언트 시스템의 **Slmgr.vbs /dlv** 출력. wscript 또는 cscript를 사용하여 명령을 실행하는지 여부에 관계없이 Ctrl+C를 사용하여 출력을 복사한 다음, 메모장에 붙여넣어 지원 담당자에게 보낼 수 있습니다.
- KMS 호스트(키 관리 서비스 로그) 및 KMS 클라이언트 시스템(애플리케이션 로그) 모두의 이벤트 로그

## <a name="additional-references"></a>추가 참조
- [핵심 팀에 문의: #Activation](https://blogs.technet.microsoft.com/askcore/tag/Activation/)


