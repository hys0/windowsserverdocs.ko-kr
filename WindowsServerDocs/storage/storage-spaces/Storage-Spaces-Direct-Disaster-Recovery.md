---
title: 하이퍼 수렴 형 인프라를 위한 재해 복구 시나리오
ms.prod: windows-server
ms.manager: eldenc
ms.technology: storage-spaces
ms.topic: article
author: johnmarlin-msft
ms.date: 03/29/2018
description: 이 문서에서는 Microsoft HCI (스토리지 공간 다이렉트)의 재해 복구를 위해 현재 사용할 수 있는 시나리오를 설명 합니다.
ms.localizationpriority: medium
ms.openlocfilehash: 8e6372ec7b4759f672c13f4bd822172afaf3faf3
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 09/27/2019
ms.locfileid: "71393752"
---
# <a name="disaster-recovery-with-storage-spaces-direct"></a>스토리지 공간 다이렉트를 사용한 재해 복구

> 적용 대상: Windows Server 2019, Windows Server 2016

이 항목에서는 재해 복구를 위해 하이퍼 수렴 형 인프라 (HCI)를 구성 하는 방법에 대 한 시나리오를 제공 합니다.

수많은 회사에서 하이퍼 수렴 형 솔루션을 실행 하 고 재해에 대 한 계획을 수립 하는 기능은 재해가 발생 하는 경우 신속 하 게 프로덕션으로 전환 하거나 다시 프로덕션으로 전환 하는 기능을 제공 합니다. 재해 복구를 위해 HCI를 구성 하는 몇 가지 방법이 있으며,이 문서에서는 현재 사용할 수 있는 옵션을 설명 합니다.

재해 발생 시 RTO (복구 시간 목표)를 중심으로 하 여 가용성을 복원 하는 방법에 대해 논의 합니다. 비즈니스에 허용 되지 않는 결과를 방지 하기 위해 서비스를 복원 해야 하는 기간입니다. 경우에 따라 프로덕션이 거의 즉시 복원 되는 경우이 프로세스가 자동으로 발생할 수 있습니다. 다른 경우에는 서비스를 복원 하기 위해 수동 관리자 개입이 발생 해야 합니다.

현재 하이퍼 수렴 형의 재해 복구 옵션은 다음과 같습니다.

1. 저장소 복제본을 활용 하는 여러 클러스터
2. 클러스터 간 hyper-v 복제본
3. Backup 및 Restore 메서드

## <a name="multiple-clusters-utilizing-storage-replica"></a>저장소 복제본을 활용 하는 여러 클러스터

[저장소 복제본](../storage-replica/storage-replica-overview.md) 은 볼륨 복제를 사용 하도록 설정 하 고 동기 및 비동기 복제를 모두 지원 합니다. 동기 또는 비동기 복제 중 하나를 선택 하는 경우 RPO (복구 지점 목표)를 고려해 야 합니다. 복구 지점 목표는 심각한 손실을 고려 하기 전에 발생 시킬 수 있는 데이터 손실의 양입니다. 동기 복제로 이동 하는 경우 동시에 두 끝에 순차적으로 기록 됩니다. 비동기를 사용 하는 경우 쓰기가 매우 빠르게 복제 되지만 여전히 손실 될 수 있습니다. 응용 프로그램 또는 파일 사용을 고려 하 여 가장 적합 한 작업을 확인 해야 합니다.

저장소 복제본은 블록 수준 복사 메커니즘과 파일 수준 비교입니다. 즉, 복제 되는 데이터의 형식에는 중요 하지 않습니다. 이렇게 하면 하이퍼 수렴 형 인프라에 대해 널리 사용 되는 옵션입니다. 또한 저장소 복제본은 복제 파트너 사이에 다른 유형의 드라이브를 사용할 수 있으므로 하나의 HCI에 모든 유형 저장소를 사용 하 고 다른 유형 저장소를 다른 유형 저장소에 둘 수 있습니다. 

저장소 복제본의 중요 한 기능 중 하나는 Azure 및 온-프레미스에서 실행할 수 있다는 것입니다. 온-프레미스에서 온-프레미스로, Azure에서 Azure로 또는 온-프레미스에서 Azure로 또는 그 반대로 설정할 수 있습니다.

이 시나리오에는 별개의 두 클러스터가 있습니다. HCI 간에 저장소 복제본을 구성 하는 경우 [클러스터 간 저장소 복제](../storage-replica/cluster-to-cluster-storage-replication.md)의 단계를 따를 수 있습니다.

![저장소 복제 다이어그램](media/storage-spaces-direct-disaster-recovery/Disaster-Recovery-Figure1.png)

저장소 복제본을 배포할 때 다음 고려 사항이 적용 됩니다. 

1.  복제 구성은 장애 조치 (Failover) 클러스터링 외부에서 수행 됩니다. 
2.  복제 방법 선택은 네트워크 대기 시간 및 RPO 요구 사항에 따라 달라 집니다. 동기는 대기 시간이 짧은 네트워크의 데이터를 크래시 일관성으로 복제 하 여 오류 발생 시 데이터가 손실 되지 않도록 합니다. 비동기는 대기 시간이 더 긴 네트워크를 통해 데이터를 복제 하지만, 각 사이트에는 오류 발생 시 동일한 복사본이 없을 수 있습니다. 
3.  재해가 발생 하는 경우 클러스터 간의 장애 조치 (failover)는 자동으로 수행 되지 않으며 저장소 복제본 PowerShell cmdlet을 통해 수동으로 오케스트레이션 해야 합니다. 위의 다이어그램에서 Clustera.contoso.com는 주 데이터베이스이 고, ClusterB는 보조입니다. Clustera.contoso.com가 다운 되 면 리소스를 가져오려면 먼저 ClusterB를 기본으로 수동으로 설정 해야 합니다. Clustera.contoso.com이 다시 시작 되 면 보조로 만들어야 합니다. 모든 데이터가 동기화 되 면 변경 내용을 적용 하 고 역할을 원래 설정 된 방식으로 다시 바꿉니다.
4.  저장소 복제본은 데이터를 복제 하기 때문에이 데이터를 활용 하는 새 가상 컴퓨터 또는 SOFS (Scale Out 파일 서버)는 복제본 파트너의 장애 조치(Failover) 클러스터 관리자 내에 만들어야 합니다.

클러스터에서 실행 되는 가상 컴퓨터 또는 SOFS가 있는 경우 저장소 복제본을 사용할 수 있습니다. 복제본 HCI에서 온라인으로 리소스를 가져오는 것은 PowerShell 스크립팅을 사용 하 여 수동 또는 자동화할 수 있습니다.

## <a name="hyper-v-replica"></a>Hyper-V 복제본

Hyper-v [복제본](https://docs.microsoft.com/windows-server/virtualization/hyper-v/manage/set-up-hyper-v-replica) 은 하이퍼 수렴 형 인프라에서 재해 복구를 위한 가상 머신 수준 복제를 제공 합니다. Hyper-v 복제본에서 수행할 수 있는 작업은 가상 컴퓨터를 사용 하 여 보조 사이트 또는 Azure (복제본)에 복제 하는 것입니다. 그런 다음 보조 사이트에서 Hyper-v 복제본은 가상 컴퓨터를 세 번째 (확장 된 복제본)에 복제할 수 있습니다.

![Hyper-v 복제 다이어그램](media/storage-spaces-direct-disaster-recovery/Disaster-Recovery-Figure2.png)

Hyper-v 복제본을 사용 하는 경우 Hyper-v에서 복제를 처리 합니다. 복제를 위해 가상 컴퓨터를 처음으로 사용 하도록 설정 하는 경우 초기 복사를 해당 복제본 클러스터로 전송 하는 방법에 대 한 세 가지 선택 옵션이 있습니다.

1.  네트워크를 통해 초기 복사본 보내기
2.  서버에 수동으로 복사할 수 있도록 외부 미디어에 초기 복사본을 보냅니다.
3.  복제본 호스트에 이미 만들어진 기존 가상 컴퓨터 사용

다른 옵션은 초기 복제를 수행 해야 하는 경우에 대 한 것입니다.

1.  즉시 복제 시작
2.  초기 복제가 수행 되는 시간을 예약 합니다. 

다음 사항을 고려해 야 합니다.

- 복제할 VHD/VHDX를 제공 합니다. 모든 항목을 복제 하거나 그 중 하나만 복제 하도록 선택할 수 있습니다.
- 저장 하려는 복구 지점의 수입니다. 복원 하려는 시점에 대 한 몇 가지 옵션을 원하는 경우 원하는 수를 지정 합니다. 복원 지점만 하나만 필요한 경우에는이를 선택할 수 있습니다.
- 볼륨 섀도 복사본 서비스 (VSS)가 증분 섀도 복사본을 복제 하는 빈도입니다.
- 변경 내용이 복제 되는 빈도 (30 초, 5 분, 15 분)입니다.

HCI가 Hyper-v 복제본에 참여 하는 경우 각 클러스터에서 [Hyper-v 복제본 브로커](https://blogs.technet.microsoft.com/virtualization/2012/03/27/why-is-the-hyper-v-replica-broker-required/) 리소스를 만들어야 합니다. 이 리소스는 다음과 같은 몇 가지 작업을 수행 합니다.

1.  는 Hyper-v 복제본이 연결할 각 클러스터에 대 한 단일 네임 스페이스를 제공 합니다.
2.  복제본 (또는 확장 된 복제본)이 첫 번째 복사본을 받을 때 해당 클러스터 내에 상주할 노드를 결정 합니다.
3.  가상 컴퓨터가 다른 노드로 이동 하는 경우 복제본 (또는 확장 된 복제본)을 소유 하는 노드를 추적 합니다. 복제가 수행 될 때 적절 한 노드에 정보를 보낼 수 있도록이를 추적 해야 합니다.

## <a name="backup-and-restore"></a>Backup 및 Restore 메서드

한 가지 기존 재해 복구 옵션은 매우 많이 언급 되지 않지만 전체 클러스터 또는 클러스터의 노드에 대 한 오류와 마찬가지로 중요 합니다. 이 시나리오에서 사용 하는 두 가지 옵션은 Windows NT 백업을 사용 하는 것입니다. 

항상 하이퍼 수렴 형 인프라를 정기적으로 백업 하는 것이 좋습니다. 클러스터 서비스가 실행 되는 동안 시스템 상태 백업을 수행 하는 경우 클러스터 레지스트리 데이터베이스는 해당 백업에 포함 됩니다. 클러스터 나 데이터베이스를 복원 하는 방법에는 두 가지 방법이 있습니다 (신뢰할 수 있는 권한 및 권한 없음).

### <a name="non-authoritative"></a>권한이 없는

신뢰할 수 없는 복원은 Windows NT 백업을 사용 하 여 수행할 수 있으며 클러스터 노드 자체의 전체 복원과 동일 합니다. 클러스터 노드 (및 클러스터 레지스트리 데이터베이스만)와 현재 클러스터 정보를 모두 적절 하 게 복원 해야 하는 경우에는 신뢰할 수 없는를 사용 하 여 복원 합니다. 신뢰할 수 없는 복원은 Windows NT Backup 인터페이스 또는 명령줄을 통해 수행할 수 있습니다. CONVERT.EXE.

노드를 복원한 후에는 클러스터에 연결 합니다. 실행 중인 기존 클러스터로 이동 하 여 모든 정보를 현재 있는 클러스터로 업데이트 하 게 됩니다.

### <a name="authoritative"></a>신뢰할 수 있는

반면에 클러스터 구성의 정식 복원은 클러스터 구성을 다시 사용 합니다. 이 복원 유형은 클러스터 정보 자체가 손실 되어 복원 해야 하는 경우에만 수행 해야 합니다. 예를 들어, 누군가가 실수로 1000 공유를 포함 하는 파일 서버를 삭제 하 여이를 다시 필요로 합니다. 클러스터의 정식 복원을 완료 하려면 명령줄에서 백업을 실행 해야 합니다.

클러스터 노드에서 신뢰할 수 있는 복원이 시작 되 면 클러스터 서비스는 클러스터 보기의 다른 모든 노드에서 중지 되 고 클러스터 구성은 고정 됩니다. 이는 클러스터가 클러스터 구성의 새 복사본을 사용 하 여 형성 되도록 복원이 실행 된 노드에서 클러스터 서비스를 먼저 시작 하는 것이 중요 한 이유입니다.

신뢰할 수 있는 복원을 실행 하려면 다음 단계를 수행 합니다.

1.  WBADMIN를 실행 합니다. 관리 명령 프롬프트에서 EXE를 실행 하 여 설치할 최신 버전의 백업을 가져오고 시스템 상태가 복원할 수 있는 구성 요소 중 하나 인지 확인 합니다.

    ```powershell
    Wbadmin get versions
    ```

2.  버전 백업에 구성 요소로 된 클러스터 레지스트리 정보가 있는지 확인 합니다. 3 단계에서 사용 하기 위해이 명령, 버전 및 응용 프로그램/구성 요소에서 필요한 몇 가지 항목이 있습니다. 예를 들어 버전의 경우 백업은 2:04am에서 2018 년 1 월 3 일에 수행 된 것 이며이는 복원 해야 하는 항목입니다.

    ```powershell
    wbadmin get items -backuptarget:\\backupserver\location
    ```

3.  필요한 클러스터 레지스트리 버전만 복구 하려면 권한 있는 복원을 시작 합니다. 

    ```powershell
    wbadmin start recovery -version:01/03/2018-02:04 -itemtype:app -items:cluster
    ```

복원이 완료 되 면이 노드가 먼저 클러스터 서비스를 시작 하 고 클러스터를 형성 해야 합니다. 그런 다음 다른 모든 노드를 시작 하 고 클러스터에 연결 해야 합니다.

## <a name="summary"></a>요약 

이 모두를 합산 하기 위해 하이퍼 수렴 형 재해 복구는 신중 하 게 계획 해야 합니다. 사용자의 요구 사항에 가장 적합 한 몇 가지 시나리오가 있으며 철저 하 게 테스트 해야 합니다. 한 가지 주의할 사항은 과거 장애 조치 (Failover) 클러스터에 대해 잘 알고 있는 경우 확대 클러스터는 몇 년 동안 매우 인기 있는 옵션입니다. 하이퍼 수렴 형 솔루션을 사용 하는 디자인은 약간 변경 되었으며 복원 력을 기반으로 합니다. 하이퍼 수렴 형 클러스터에서 두 개의 노드가 손실 되 면 전체 클러스터가 다운 됩니다. 이 경우 하이퍼 수렴 형 환경에서 스트레치 시나리오는 지원 되지 않습니다.


