---
title: 원격 데스크톱 가상화 호스트 조정 성능
description: 원격 데스크톱 가상화 호스트를 위한 성능 튜닝
ms.prod: windows-server-threshold
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: HammadBu; VladmiS
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 0aa359644f5e9bf85f4e013e6571276716ed0218
ms.sourcegitcommit: d84dc3d037911ad698f5e3e84348b867c5f46ed8
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 05/28/2019
ms.locfileid: "66266619"
---
# <a name="performance-tuning-remote-desktop-virtualization-hosts"></a>원격 데스크톱 가상화 호스트 조정 성능


원격 데스크톱 가상화 호스트 (RD 가상화 호스트)는 가상 데스크톱 인프라 (VDI) 시나리오를 지원 하 고 실행 하는 서버에서 호스트 되는 virtual machines에서 Windows 기반 응용 프로그램을 실행 하는 여러 동시 사용자 수는 역할 서비스 Windows Server 2016 및 Hyper-v가 설치 합니다.

Windows Server 2016에는 두 가지 유형의 가상 데스크톱, 개인용 가상 데스크톱 및 풀링된 가상 데스크톱 지원합니다.

**항목 내용**

-   [일반적인 고려 사항](#general)

-   [성능 최적화](#perfopt)

## <a href="" id="general"></a>일반적인 고려 사항


### <a name="storage"></a>저장 공간

저장소 가능성이 가장 높은 성능 병목 상태 이며 가상 컴퓨터 상태 변경에 의해 생성 되는 I/O 부하를 올바르게 처리 하려면 저장소 크기를 조정 하는 것이 중요 합니다. 파일럿 실행 또는 시뮬레이션 적절 하지 않은 경우 4 개의 활성 가상 컴퓨터에 대 한 하나의 디스크 스핀 들을 프로 비전 하는 것이 좋습니다. 적절 한 쓰기 성능 (예: RAID 1 + 0)이 있는 디스크 구성을 사용 합니다.

해당 하는 경우 사용 하 여 디스크 중복 제거 및 캐시를 디스크 부하를 읽기 위해 이미지의 상당 부분을 캐시 하 여 성능 속도 저장소 솔루션을 사용 하도록 설정.

### <a name="data-deduplication-and-vdi"></a>데이터 중복 제거 및 VDI

Windows Server 2012 R2에 도입 된, 데이터 중복 제거는 열려 있는 파일의 최적화를 지원 합니다. 중복 제거 된 볼륨에서 실행 중인 가상 컴퓨터를 사용 하려면 가상 머신 파일을 Hyper-v 호스트에서 별도 호스트에 저장 해야 합니다. Hyper-v 및 중복 제거는 동일한 컴퓨터에서 실행 되는 경우 두 기능 시스템 리소스에 대 한 경합를 업데이트 하 고 전반적인 성능이 저하 됩니다.

볼륨 "가상 데스크톱 인프라 (VDI)" 중복 제거 최적화 형식을 사용 하도 구성 되어야 합니다. 서버 관리자를 사용 하 여 구성할 수 있습니다 (**File and Storage Services**  - &gt; **볼륨**  - &gt; **중복제거설정**) 또는 다음 Windows PowerShell을 사용 하 여 명령:

``` syntax
Enable-DedupVolume <volume> -UsageType HyperV
```

> [!Note]
> 열려 있는 파일의 데이터 중복 제거 최적화는 SMB 3.0을 통한 원격 저장소를 사용 하 여 Hyper-v를 사용 하 여 VDI 시나리오에 대해서만 지원 됩니다.

### <a name="memory"></a>메모리

서버 메모리 사용량 세 가지 주요 요소에 의해 좌우 됩니다.

-   운영 체제 오버 헤드

-   Hyper-v 가상 머신 당 오버 헤드는 서비스

-   각 가상 머신에 할당 된 메모리

일반적인 기술 작업자 워크 로드의 경우 게스트 가상 컴퓨터 실행 x86 Window 8 또는 Windows 8.1 주어져야 ~ 512 MB의 메모리를 기준으로 합니다. 그러나 동적 메모리 800MB, 워크 로드에 따라 게스트 가상 머신의 메모리를 가능성이 증가 합니다. X64에서는 대 한 참조 800 MB부터을 1024mb로 증가 합니다.

따라서 것이 중요 서버 메모리가 부족 하 여 예상 되는 게스트 가상 머신의 필요한 메모리를 충족 하기 위해 제공 하는 서버에 대 한 충분 한 양의 메모리를 허용 합니다.

### <a name="cpu"></a>CPU

RD 가상화 호스트 서버에 대 한 서버 용량을 계획할 때 물리적 코어당 가상 컴퓨터 수가 워크 로드의 특성에 따라 달라 집니다. 시작 지점으로 물리적 코어당 12 대의 가상 컴퓨터를 계획 하 고 성능 및 밀도 유효성을 검사 하는 적절 한 시나리오를 실행 하는 합니다. 더 높은 밀도 워크 로드의 세부 사항에 따라 달성 될 수 있습니다.

하이퍼스레딩을 사용 권장 사항 이지만 논리 프로세서 수가 아닌 실제 코어 수에 따라 초과 구독 비율을 계산 해야 합니다. 이렇게 하면 예상된 성능 수준에는 CPU 당 기준입니다.

### <a name="virtual-gpu"></a>가상 GPU

RD 가상화 호스트에 대 한 Microsoft RemoteFX 데스크톱 인프라 (VDI (가상) 호스트 쪽 원격 작업, 렌더링 캡처 인코딩 파이프라인, 매우 효율적인 GPU 기반 인코드에 대 한 풍부한 그래픽 환경을 제공, 클라이언트에 따라 제한 작업 및 가상 GPU DirectX를 사용 합니다. RD 가상화 호스트에 대 한 RemoteFX DirectX11를 DirectX9에서 가상 GPU를 업그레이드합니다. 또한 더 높은 해상도에서 자세한 모니터링을 지원 하 여 사용자 환경이 개선 됩니다.

RemoteFX DirectX11 환경은 에뮬레이트된 드라이버를 통해 GPU 하드웨어 없이 사용할 수 있습니다. 이 소프트웨어 GPU 좋은 경험을 제공 하지만 RemoteFX 가상 그래픽 처리 장치 (VGPU)는 하드웨어 가속 환경을 가상 데스크톱에 추가 합니다.

를 이용 하려면 RemoteFX VGPU 환경의 Windows Server 2016을 실행 하는 서버에서 호스트 서버에서 GPU 드라이버 (예: DirectX11.1 또는 WDDM 1.2) 해야 합니다. RD 가상화 호스트에 RemoteFX를 사용 하 여 사용할 GPU 제품에 대 한 자세한 내용은 GPU 공급자에 게 문의 합니다.

VDI 배포에서 RemoteFX 가상 GPU를 사용 하는 경우 배포 용량 사용 시나리오 및 하드웨어 구성에 따라 달라 집니다. 배포를 계획할 때 다음 사항을 고려 합니다.

-   시스템에서 Gpu의 수

-   Gpu에서 비디오 메모리 용량

-   시스템에서 프로세서 및 하드웨어 리소스

### <a name="remotefx-server-system-memory"></a>RemoteFX 서버 시스템 메모리

가상 GPU가 사용 하도록 설정 된 모든 가상 데스크톱, RemoteFX 및 RemoteFX 사용 서버 게스트 운영 체제에서 시스템 메모리를 사용 합니다. 하이퍼바이저는 게스트 운영 체제에 대 한 시스템 메모리의 가용성을 보장합니다. 서버에서 각 가상 GPU 사용 가상 데스크톱 하이퍼바이저에는 시스템 메모리 요구 사항이 보급 해야 합니다. 가상 GPU 사용 가상 데스크톱을 시작할 때 하이퍼바이저 VGPU 지원 가상 데스크톱에 대 한 RemoteFX 사용 서버에 대 한 추가 시스템 메모리를 예약 합니다.

RemoteFX 사용 서버에 대 한 메모리 요구 사항 이므로 동적 RemoteFX 사용 서버에 사용 된 메모리 양은 VGPU 지원 가상 데스크톱에 대 한 최대 해상도와 연관 된 모니터의 수에 따라 다릅니다. 이러한 모니터링 합니다.

### <a name="remotefx-server-gpu-video-memory"></a>RemoteFX 서버 GPU 비디오 메모리

모든 가상 GPU 사용 가상 데스크톱 바탕 화면을 렌더링 하는 호스트 서버에서 GPU 하드웨어에서 비디오 메모리를 사용 합니다. 렌더링 하는 것 외에도 비디오 메모리 렌더링된 화면 압축 코덱은에서 사용 됩니다. 필요한 메모리 양이 직접 가상 컴퓨터를 프로 비전 되는 모니터의 양을 기반으로 합니다.

예약 된 비디오 메모리 모니터 및 시스템 화면 해상도의 수에 따라 다릅니다. 일부 사용자에 게 특정 작업에 대 한 화면 해상도 높이면 필요할 수 있습니다. 다른 모든 설정은 일정 하 게 유지 하는 경우에 더 낮은 해상도 설정 사용 하 여 확장성이 커집니다.

### <a name="remotefx-processor"></a>RemoteFX 프로세서

하이퍼바이저는 RemoteFX 지원 서버 및 CPU에서 GPU 사용 가상 가상 데스크톱을 예약합니다. 시스템 메모리와는 달리 RemoteFX 하이퍼바이저와 공유 해야 하는 추가 리소스에 관련 된 정보가 없습니다. 추가 CPU 오버 헤드가 RemoteFX 가상 GPU 사용 가상 데스크톱에 제공 하는 가상 GPU 드라이버 및 사용자 모드 원격 데스크톱 프로토콜 스택의 실행 관련이 있습니다.

RemoteFX 사용 서버의 오버 헤드가 증가, 시스템 (rdvgm.exe) 프로세스가 실행 되기 때문에 가상 GPU 사용 가상 데스크톱 당 합니다. 이 프로세스는 GPU에서 명령을 실행 하려면 그래픽 장치 드라이버를 사용 합니다. 코덱에서 또한 클라이언트로 다시 전송 해야 하는 화면 데이터 압축에 대 한 Cpu를 사용 합니다.

가상 프로세서를 더 나은 사용자 환경을 의미합니다. 가상 GPU 사용 가상 데스크톱 당 두 개 이상의 가상 Cpu를 할당 하는 것이 좋습니다. X64를 사용 하는 것이 좋습니다 가상 GPU 사용 가상 데스크톱에 대 한 아키텍처 때문에 가상 컴퓨터는 x86에 비해 더 x64 성능 가상 컴퓨터.

### <a name="remotefx-gpu-processing-power"></a>RemoteFX GPU 처리량

모든 가상 GPU 사용 가상 데스크톱에 대 한 RemoteFX 사용 서버에서 실행 중인 해당 DirectX 프로세스 있습니다. 이 프로세스는 실제 GPU에 RemoteFX 가상 데스크톱에서 수신 하는 모든 그래픽 명령을 재생 합니다. 실제 GPU에 대 한 동시에 여러 DirectX 응용 프로그램을 실행 하는 것이 같습니다.

일반적으로 그래픽 장치 및 드라이버는 바탕 화면에서 잠시 응용 프로그램을 실행 하 여 조정 됩니다. RemoteFX는 고유한 방식으로 사용할 Gpu를 확장 합니다. RemoteFX 서버의 GPU 성능을 측정할 RemoteFX 요청에 대 한 GPU 응답을 측정 하려면 성능 카운터 추가 되었습니다.

GPU 리소스는 리소스 부족, 경우에 일반적으로 읽기 및 쓰기 작업 완료 시간이 오래 GPU 사용 합니다. 성능 카운터를 사용 하 여 관리자 작업을 수행할 수 하며, 예방 가능한, 최종 사용자를 위한 가동 중지 시간 가능성을 제거 합니다.

다음 성능 카운터는 가상 GPU 성능을 측정 하는 RemoteFX 서버:

**RemoteFX 그래픽**

-   **클라이언트 리소스 부족 건너뜀/초-프레임** 리소스가 부족 하 여 클라이언트 초당 프레임 수가 건너뜀

-   **그래픽 압축률** 입력 되는 바이트의 수로 인코딩된 바이트 수의 비율

**RemoteFX 루트 GPU 관리**

-   **리소스: 서버 Gpu에서 TDRs** 총 횟수를 TDR 서버의 GPU에서 시간이 초과 되는

-   **리소스: RemoteFX를 실행 중인 virtual machines** RemoteFX 3D 비디오 어댑터를 설치 되어 있는 가상 머신의 총 수

-   **VRAM: GPU 당 사용 가능한 MB** 사용 되지 않는 전용된 비디오 메모리의 양

-   **VRAM: GPU 당 예약 된 %** RemoteFX에 대 한 예약 된 전용된 비디오 메모리의 백분율

**RemoteFX 소프트웨어**

-   **모니터에 대 한 속도 캡처** \[1-4\] 1-4 모니터에 대 한 RemoteFX 캡처 속도 표시 합니다.

-   **압축 비율** Deprecated in Windows 8에서 대체 **그래픽 압축 비율**

-   **프레임/초 지연** 그래픽 데이터를 특정 시간 내에 전송 되지 않았습니다 초당 프레임 수

-   **캡처의 응답 시간을 GPU** 대기 시간 측정 RemoteFX 캡처 내 (마이크로초) GPU 작업이 완료

-   **렌더링의 응답 시간을 GPU** 대기 시간 측정 RemoteFX 렌더링 내 (마이크로초) GPU 작업이 완료

-   **바이트 출력** RemoteFX의 총 바이트 출력

-   **클라이언트 수/초를 기다리고** Deprecated in Windows 8에서 대체 **건너뜀/초-클라이언트 리소스가 부족 하 여 프레임**

**RemoteFX vGPU 관리**

-   **리소스: 가상 컴퓨터에 로컬 TDRs** TDRs이 가상 컴퓨터 (가상 컴퓨터에 전파 하는 서버는 포함 되지 않습니다 TDRs)에서 발생 한 총 수

-   **리소스: 서버에 의해 전파 TDRs** TDRs 서버에서 발생 하 고 가상 컴퓨터에 전파 하는 총 수

**RemoteFX 가상 머신 vGPU 성능**

-   **데이터: 표시/sec 호출** 초당 가상 컴퓨터의 바탕 화면에 렌더링 될 수 있는 작업 (초)의 총 수

-   **데이터: 표시/sec 나가는** 초당 서버 GPU에는 가상 컴퓨터에서 전송 된 있는 작업의 총 수

-   **데이터: 읽기 바이트/초** 는 RemoteFX 지원 서버에서 초당 읽은 바이트의 총 수

-   **데이터: 보낼 바이트 수/초** 서버로 RemoteFX 지원 GPU 초당 전송 된 바이트의 총 수

-   **DMA: 평균 대기 시간 (초) 통신 버퍼가** 통신 버퍼가에 소요 된 평균 기간 (초)

-   **DMA: DMA 버퍼 대기 시간 (초)** 시간 (초) 완료 될 때까지 DMA가 전송 하는 경우

-   **DMA: 큐 길이** RemoteFX 3D 비디오 어댑터의 DMA 큐 길이

-   **리소스: GPU 당 TDR 시간 초과** 가상 머신에서 GPU 당 발생 한 수의 TDR 시간 제한

-   **리소스: GPU 엔진 당 TDR 시간 초과** 가상 머신에서 GPU 당 발생 한 수의 TDR 시간 제한 엔진

RemoteFX 가상 GPU 성능 카운터 외에도 비디오 메모리 사용량 및 GPU 사용률을 보여 주는 프로세스 탐색기를 사용 하 여 GPU 사용률을 측정할 수 있습니다.

## <a href="" id="perfopt"></a>성능 최적화


### <a name="dynamic-memory"></a>동적 메모리

동적 메모리 사용 보다 효율적으로 실행 중인 가상 컴퓨터 간의 메모리 분산 되는 방법을 분산 하 여 Hyper-v를 실행 하는 서버 메모리 리소스의 사용률입니다. 메모리 변경 워크 로드에 대 한 응답에서 가상 머신 간의 동적으로 다시 할당할 수 있습니다.

동적 메모리를 사용 하면 성능이 나 확장성을 희생 하지 않고 이미 있는 리소스를 사용 하 여 가상 컴퓨터 밀도 높일 수 있습니다. 결과 보다 쉽게 관리 및 비용 절감으로 변환할 수 있습니다는 고가의 서버 하드웨어 리소스를 더 효율적으로 사용 합니다.

게스트 운영 체제에서 Windows 8을 실행 하 고 위에서 여러 개의 논리적 프로세서에 걸쳐 있는 가상 프로세서를 사용 하 여 고려 메모리 사용량을 최소화 하기 위해 동적 메모리를 사용 하 여 실행 하 고 성능을 개선 하기 위해 동적 메모리를 사용 하지 않도록 설정 간의 관계 응용 프로그램의 인식 컴퓨터 토폴로지입니다. 이러한 응용 프로그램에는 일정 예약 및 메모리 할당 결정을 내릴 토폴로지 정보를 활용할 수 있습니다.

### <a name="tiered-storage"></a>계층화된 저장소

RD 가상화 호스트는 가상 데스크톱 풀에 대 한 계층화 된 저장소를 지원합니다. 모든 풀링된 가상 데스크톱 컬렉션 내에서 공유 되는 물리적 컴퓨터는 미러된 SSD (반도체 드라이브)와 같은 작은 크기, 고성능 저장소 솔루션을 사용할 수 있습니다. 풀링된 가상 데스크톱에 배치할 수 RAID와 같은 저렴 하 고 기존의 저장소 1 + 0입니다.

물리적 컴퓨터를 배치할는 SSD는 읽기-I/Os의 풀링된 가상 데스크톱에서 대부분 관리 운영 체제로 이동 하기 때문에 있습니다. 물리적 컴퓨터에서 사용 되는 저장소 얼마나 높아야 유지 해야 하므로 초당 읽기 I/o입니다.

이 배포 구성은 성능 필요한 비용 효율적인 성능을 보장 합니다. SSD 더 작은 크기 디스크 (구성에 따라 컬렉션당 ~ 20 GB)에 더 높은 성능을 제공합니다. 풀링된 가상 데스크톱에 대 한 기존 저장소 (RAID 1 + 0) 가상 컴퓨터당 약 3GB를 사용 합니다.

### <a name="csv-cache"></a>CSV 캐시

Windows Server 2012에서 장애 조치 클러스터링에서 클러스터 공유 볼륨 (CSV)를 캐싱을 제공 합니다. 풀링된 가상 데스크톱 컬렉션에 매우 유용 대부분 읽기의 I/o 관리 운영 체제에서 제공 하는 경우. CSV 캐시는 I/O를 줄일 수는 시스템 메모리에서 전달 하 고 두 번 이상 읽는 블록 캐시 있기 때문에 몇 배 많은 규모로 여 고성능을 제공 합니다. CSV 캐시에 대 한 자세한 내용은 참조 하세요. [CSV 캐시를 사용 하도록 설정 하는 방법을](http://blogs.msdn.com/b/clustering/archive/2012/03/22/10286676.aspx)합니다.

### <a name="pooled-virtual-desktops"></a>풀링된 가상 데스크톱

기본적으로 풀링된 가상 데스크톱 롤백됩니다 초기 상태를 마지막으로 사용자 로그인 중단 되기 때문에 Windows 운영 체제에 대 한 모든 변경 내용을 사용자가 로그인 한 후.

롤백이 사용 하지 않도록 설정할 경우에 여전히 임시 조건을 일반적으로 풀링된 가상 데스크톱 컬렉션은 이므로 가상 데스크톱 템플릿을 다양 한 업데이트로 인해 다시 생성 합니다.

Windows 기능 및 영구 상태에 종속 된 서비스를 해제 하려면 것이 좋습니다. 또한 편이 비엔터프라이즈 시나리오에 주로 사용 되는 서비스를 해제 합니다.

모든 광범위 한 배포 하기 전에 각 특정 서비스를 적절 하 게 평가 되어야 합니다. 다음 몇 가지 초기 고려해 야 합니다.

| 서비스                                      | 이유가 무엇일까요?                                                                                                                                                                                                      |
|----------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 자동 업데이트                                  | 풀링된 가상 데스크톱이 가상 데스크톱 템플릿을 다시 만들어 업데이트 됩니다.                                                                                                                          |
| 오프 라인 파일                                | 가상 데스크톱은 항상 온라인 상태이 고 네트워킹 보기에서 연결 합니다.                                                                                                                         |
| 백그라운드 조각 모음                            | 파일 시스템 변경 내용 (때문에 초기 상태를 다시 만들거나 다시 모든 풀링된 가상 데스크톱 만들기는 가상 데스크톱 템플릿을 롤백) 사용자가 로그인 한 후에 삭제 됩니다. |
| 절전 모드 또는 최대 절전 모드로 전환                           | VDI에 대 한 이러한 개념이 없으므로                                                                                                                                                                                   |
| 버그 확인 메모리 덤프                        | 이러한 개념이 없으므로 풀링된 가상 데스크톱에 대 한 합니다. 버그 확인 풀링된 가상 데스크톱은 기본적인 상태에서 시작 됩니다.                                                                                       |
| WLAN 자동 구성                              | VDI 용 WiFi 장치 인터페이스가 없으므로                                                                                                                                                                 |
| Windows Media Player 네트워크 공유 서비스 | 소비자 중심 서비스                                                                                                                                                                                  |
| 홈 그룹 공급자                          | 소비자 중심 서비스                                                                                                                                                                                  |
| 인터넷 연결 공유                  | 소비자 중심 서비스                                                                                                                                                                                  |
| Media Center 서비스를 확장 합니다.               | 소비자 중심 서비스                                                                                                                                                                                  |

 

**참고**    이 목록은 아닙니다 전체 목록이 될 내용을 의도 한 목표와 시나리오에 영향 됩니다. 자세한 내용은 참조 하세요. [핫 누름, 해제 되도록 이제 Windows 8 VDI 최적화 스크립트 PFE의 우대!](http://blogs.technet.com/b/jeff_stokes/archive/2013/04/09/hot-off-the-presses-get-it-now-the-windows-8-vdi-optimization-script-courtesy-of-pfe.aspx)합니다.

 

**참고**    SuperFetch Windows 8에서 기본적으로 사용 됩니다. VDI를 인식 하 고 사용 해야 합니다. SuperFetch는 VDI에 대 한 유용한 인 메모리 페이지 공유를 통해 메모리 소비를 줄일 수 있습니다. 풀링된 가상 데스크톱 Windows 7을 실행, SuperFetch 해야 비활성화할 수는 없지만 Windows 7을 실행 개인용 가상 데스크톱에 대 한 것에 남아 있어야 합니다.

 
