---
title: 의 사이트 정의 및 도메인 컨트롤러 배치 성능 튜닝 추가
description: Active Directory 성능 튜닝에서 사이트 정의 및 도메인 컨트롤러 배치 고려 사항
ms.prod: windows-server
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: timwi; chrisrob; herbertm; kenbrumf;  mleary; shawnrab
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 19574c859e038374a4cf3fe1e452adae0891e067
ms.sourcegitcommit: 771db070a3a924c8265944e21bf9bd85350dd93c
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 06/27/2020
ms.locfileid: "85471488"
---
# <a name="proper-placement-of-domain-controllers-and-site-considerations"></a>적절한 도메인 컨트롤러 배치 및 사이트 고려 사항

적절 한 사이트 정의는 성능에 매우 중요 합니다. 사이트를 벗어난 클라이언트는 인증 및 쿼리에 대해 성능이 저하 될 수 있습니다. 또한 클라이언트에 i p v 6이 도입 됨에 따라 IPv4 또는 IPv6 주소에서 요청을 가져올 수 있으며 IPv6에 대 한 사이트를 올바르게 정의 해야 Active Directory. 운영 체제는 모두 구성 된 경우 i p v 6로 IPv6을 선호 합니다.

Windows Server 2008부터 도메인 컨트롤러는 클라이언트에서 사용 해야 하는 사이트를 확인 하기 위해 이름 확인을 사용 하 여 역방향 조회를 수행 하려고 시도 합니다. 이로 인해 ATQ 스레드 풀이 고갈 되어 도메인 컨트롤러가 응답 하지 않을 수 있습니다. 적절 한 해결 방법은 i p v 6에 대 한 사이트 토폴로지를 올바르게 정의 하는 것입니다. 한 가지 해결 방법으로, 이름 확인 인프라를 최적화 하 여 도메인 컨트롤러 요청에 신속 하 게 대응할 수 있습니다. 자세한 내용은 [Windows server 2008 또는 Windows server 2008 R2 도메인 컨트롤러의 LDAP 또는 Kerberos 요청 지연 응답을](https://support.microsoft.com/kb/2668820)참조 하세요.

추가 고려 사항은 Rodc를 사용 하는 시나리오에 대 한 읽기/쓰기 Dc를 찾는 것입니다.  특정 작업에는 읽기 전용 도메인 컨트롤러에 충분 한 쓰기 가능한 도메인 컨트롤러에 대 한 액세스 권한이 필요 하거나 쓰기 가능한 도메인 컨트롤러를 대상으로 합니다.  이러한 시나리오를 최적화 하는 데는 두 가지 경로가 사용 됩니다.
-   읽기 전용 도메인 컨트롤러에 충분 한 경우 쓰기 가능한 도메인 컨트롤러에 연결 합니다.  이렇게 하려면 응용 프로그램 코드를 변경 해야 합니다.
-   쓰기 가능한 도메인 컨트롤러가 필요할 수 있습니다.  읽기/쓰기 도메인 컨트롤러를 중앙 위치에 저장 하 여 대기 시간을 최소화 합니다.

자세한 내용은 다음을 참조 하세요.
-   [Rodc와의 응용 프로그램 호환성](https://technet.microsoft.com/library/cc772597.aspx)
-   [ADSI (Active Directory Service Interface) 및 RODC (읽기 전용 도메인 컨트롤러)-성능 문제 방지](https://blogs.technet.microsoft.com/fieldcoding/2012/06/24/active-directory-service-interface-adsi-and-the-read-only-domain-controller-rodc-avoiding-performance-issues/)

## <a name="optimize-for-referrals"></a>조회를 위한 최적화

조회는 도메인 컨트롤러가 쿼리 된 파티션의 복사본을 호스팅하지 않을 때 LDAP 쿼리를 리디렉션하는 방법입니다. 조회가 반환 되 면 파티션의 고유 이름, DNS 이름 및 포트 번호가 포함 됩니다. 클라이언트는이 정보를 사용 하 여 파티션을 호스트 하는 서버에서 쿼리를 계속 합니다. 이는 DCLocator 시나리오 이며 모든 권장 사항 사이트 정의와 도메인 컨트롤러 배치가 유지 되지만 조회에 의존 하는 응용 프로그램은 종종 간과 됩니다. 사이트 정의 및 도메인 컨트롤러 배치를 포함 하는 AD 토폴로지가 클라이언트의 요구 사항을 올바르게 반영 하는지 확인 하는 것이 좋습니다. 또한 단일 사이트에 여러 도메인의 도메인 컨트롤러를 포함 하거나, DNS 설정을 조정 하거나, 응용 프로그램의 사이트를 재배치할 수 있습니다.

## <a name="optimization-considerations-for-trusts"></a>트러스트에 대 한 최적화 고려 사항

포리스트 간 시나리오에서 트러스트는 다음 도메인 계층 구조에 따라 처리 됩니다.-자식 도메인-자식 도메인- &gt; &gt; 포리스트 루트 도메인- &gt; 하위 도메인 &gt; -하위 도메인 즉, 트러스트 계층의 Dc 전송을 인증 요청의 집계로 인해 포리스트 루트 및 각 부모의 보안 채널이 오버 로드 될 수 있습니다. 이로 인해 높은 지역 분산의 Active Directory에 대 한 지연이 발생할 수 있습니다 .이 경우에는 위의 흐름에 영향을 줄 수 있는 매우 잠재적인 링크를 전송 해야 합니다. 오버 로드는 포리스트 간 및 하위 수준 신뢰 시나리오에서 발생할 수 있습니다. 다음 권장 사항은 모든 시나리오에 적용 됩니다.

-   보안 채널을 통한 부하를 지원 하도록 MaxConcurrentAPI를 적절히 조정 합니다. 자세한 내용은 [MaxConcurrentApi 설정을 사용 하 여 NTLM 인증에 대 한 성능 조정을 수행 하는 방법](https://support.microsoft.com/kb/2688798/EN-US)을 참조 하세요.

-   부하에 따라 적절 하 게 바로 가기 트러스트를 만듭니다.

-   도메인의 모든 도메인 컨트롤러에서 이름 확인을 수행 하 고 트러스트 된 도메인의 도메인 컨트롤러와 통신할 수 있는지 확인 합니다.

-   위치 고려 사항이 트러스트를 고려 하는지 확인 합니다.

-   가능 하면 Kerberos를 사용 하도록 설정 하 고 보안 채널의 사용을 최소화 하 여 MaxConcurrentAPI 병목 상태가 발생 하는 위험을 줄입니다.

도메인 간 트러스트 시나리오는 많은 고객에 게 일관 되 게 취약 한 영역입니다. 이름 확인 및 연결 문제 (주로 방화벽으로 인해)는 트러스팅 도메인 컨트롤러에서 리소스 소모를 야기 하 고 모든 클라이언트에 영향을 줍니다. 또한 종종 간과 되는 시나리오는 신뢰할 수 있는 도메인 컨트롤러에 대 한 액세스를 최적화 하는 것입니다. 제대로 작동 하는지 확인 하는 주요 영역은 다음과 같습니다.

-   트러스팅 도메인 컨트롤러에서 사용 하는 DNS 및 WINS 이름 확인에서 트러스트 된 도메인의 정확한 도메인 컨트롤러 목록을 확인할 수 있는지 확인 합니다.

    -   정적으로 추가 된 레코드는 시간이 지남에 따라 부실 하 고 연결 문제가 발생 하는 경향이 있습니다. DNS 전달, 동적 DNS 및 WINS/DNS 인프라 병합은 장기 실행에서 더 쉽게 관리할 수 있습니다.

    -   클라이언트에서 액세스 해야 하는 환경에 있는 모든 리소스에 대해 전달 및 역방향 조회 영역에 대 한 전달자, 조건부 전달 및 보조 복사본의 적절 한 구성을 확인 합니다. 이를 위해이 작업은 수동으로 유지 관리 해야 하며 오래 된 경향이 있습니다. 인프라 통합이 이상적입니다.

-   트러스팅 도메인의 도메인 컨트롤러는 트러스트 된 도메인에서 먼저 같은 사이트에 있는 도메인 컨트롤러를 찾은 다음 일반 로케이터에 대 한 장애 복구 (failback)를 시도 합니다.

    -   DCLocator 작동 방식에 대 한 자세한 내용은 [가장 가까운 사이트에서 도메인 컨트롤러 찾기](https://technet.microsoft.com/library/cc978016.aspx)를 참조 하십시오.

    -   동일한 위치의 도메인 컨트롤러를 반영 하도록 트러스트 된 도메인과 트러스팅 도메인 간에 사이트 이름을 수렴 합니다. 서브넷 및 IP 주소 매핑이 두 포리스트의 사이트에 제대로 연결 되어 있는지 확인 합니다. 자세한 내용은 [포리스트 트러스트를 통한 도메인 로케이터](https://blogs.technet.com/b/askds/archive/2008/09/24/domain-locator-across-a-forest-trust.aspx)를 참조 하세요.

    -   도메인 컨트롤러 위치에 대 한 DCLocator 요구 사항에 따라 포트가 열려 있는지 확인 합니다. 도메인 사이에 방화벽이 있는 경우 모든 트러스트에 대해 방화벽이 제대로 구성 되어 있는지 확인 합니다. 방화벽이 열려 있지 않은 경우 트러스팅 도메인 컨트롤러는 여전히 트러스트 된 도메인에 대 한 액세스를 시도 합니다. 어떤 이유로 든 통신이 실패 하는 경우 트러스팅 도메인 컨트롤러는 결국 트러스트 된 도메인 컨트롤러에 대 한 요청을 시간 초과 합니다. 그러나 이러한 시간 제한은 요청당 몇 초 정도 걸리며 들어오는 요청 볼륨이 높으면 트러스팅 도메인 컨트롤러의 네트워크 포트를 고갈 시킬 수 있습니다. 클라이언트는 중지 된 스레드로 도메인 컨트롤러에서 시간 초과가 발생 하 여 대기 중인 응용 프로그램 (응용 프로그램이 포그라운드 스레드에서 요청을 실행 하는 경우)으로 변환 될 수 있습니다. 자세한 내용은 [도메인 및 트러스트를 위한 방화벽을 구성 하는 방법](https://support.microsoft.com/kb/179442)을 참조 하세요.

    -   DnsAvoidRegisterRecords를 사용 하 여 일반적인 로케이터에 대 한 광고에서 위성 사이트와 같은 성능이 좋지 않거나 대기 시간이 긴 도메인 컨트롤러를 제거 합니다. 자세한 내용은 [클라이언트 사이트 외부에 있는 도메인 컨트롤러 또는 글로벌 카탈로그의 위치를 최적화](https://support.microsoft.com/kb/306602)하는 방법을 참조 하세요.

        > [!NOTE]
        > 클라이언트에서 사용할 수 있는 도메인 컨트롤러 수에 대 한 실질적인 제한은 약 50입니다. 이러한 도메인 컨트롤러는 가장 많은 사이트에서 가장 높은 용량의 도메인 컨트롤러 여야 합니다.


    -  트러스트 된 도메인 및 트러스팅 도메인의 도메인 컨트롤러를 동일한 물리적 위치에 배치 하는 것이 좋습니다.

모든 신뢰 시나리오의 경우 자격 증명은 인증 요청에 지정 된 도메인에 따라 라우팅됩니다. 이는 LookupAccountName 및 Lsn에 대 한 쿼리의 경우에도 마찬가지입니다 .이는 다른 사용자 뿐만 아니라 가장 일반적으로 사용 되는 Api입니다. 이러한 Api에 대 한 도메인 매개 변수에 NULL 값이 전달 되 면 도메인 컨트롤러는 사용 가능한 모든 트러스트 된 도메인에 지정 된 계정 이름을 찾으려고 시도 합니다.

-   NULL 도메인이 지정 된 경우 사용 가능한 모든 트러스트를 확인 하지 않습니다. [LsaLookupRestrictIsolatedNameLevel 레지스트리 항목을 사용 하 여 외부 트러스트 된 도메인에서 격리 된 이름의 조회를 제한 하는 방법](https://support.microsoft.com/kb/818024)

-   사용 가능한 모든 트러스트에서 NULL 도메인이 지정 된 인증 요청 전달을 사용 하지 않도록 설정 합니다. [Active Directory 도메인 컨트롤러에 외부 트러스트가 많은 경우 Lsass.exe 프로세스가 응답 하지 않을 수 있습니다.](https://support.microsoft.com/kb/923241/EN-US)

## <a name="additional-references"></a>추가 참조
- [Active Directory 서버 성능 조정](index.md)
- [하드웨어 고려 사항](hardware-considerations.md)
- [LDAP 고려 사항](ldap-considerations.md)
- [ADDS 성능 문제 해결](troubleshoot.md)
- [Active Directory 도메인 서비스의 용량 계획](https://go.microsoft.com/fwlink/?LinkId=324566)