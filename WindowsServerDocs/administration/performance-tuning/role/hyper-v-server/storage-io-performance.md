---
title: Hyper-v 저장소 i/o 성능
description: Hyper-v 성능 조정의 저장소 i/o 성능 고려 사항
ms.prod: windows-server
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: asmahi; sandysp; jopoulso
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: c77f084e06e71c9aafd658b59ff385af85ef0b9d
ms.sourcegitcommit: 771db070a3a924c8265944e21bf9bd85350dd93c
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 06/27/2020
ms.locfileid: "85471318"
---
# <a name="hyper-v-storage-io-performance"></a>Hyper-v 저장소 i/o 성능

이 섹션에서는 가상 머신에서 저장소 i/o 성능 튜닝에 대 한 다양 한 옵션과 고려 사항을 설명 합니다. 저장소 i/o 경로는 게스트 저장소 스택에서 호스트 가상화 계층을 통해 호스트 저장소 스택으로 확장 된 다음 실제 디스크로 확장 됩니다. 이러한 각 단계에서 최적화를 수행할 수 있는 방법에 대 한 설명은 다음과 같습니다.

## <a name="virtual-controllers"></a>가상 컨트롤러

Hyper-v는 세 가지 유형의 가상 컨트롤러 즉, IDE, SCSI 및 가상 호스트 버스 어댑터 (Hba)를 제공 합니다.

## <a name="ide"></a>IDE

IDE 컨트롤러는 IDE 디스크를 가상 컴퓨터에 노출 합니다. IDE 컨트롤러는 에뮬레이션 되며 가상 컴퓨터 Integration Services 없이 이전 버전의 Windows를 실행 하는 게스트 Vm에 사용할 수 있는 유일한 컨트롤러입니다. 가상 컴퓨터 Integration Services와 함께 제공 되는 IDE 필터 드라이버를 사용 하 여 수행 되는 디스크 i/o는 에뮬레이트된 IDE 컨트롤러에서 제공 하는 디스크 i/o 성능 보다 훨씬 더 낫습니다. IDE 디스크는 이러한 장치에 대해 실행할 수 있는 최대 i/o 크기로 인해 성능 제한이 있으므로 운영 체제 디스크에 대해서만 사용 하는 것이 좋습니다.

## <a name="scsi-sas-controller"></a>SCSI (SAS 컨트롤러)

SCSI 컨트롤러는 SCSI 디스크를 가상 컴퓨터에 노출 하 고 각 가상 SCSI 컨트롤러는 최대 64 장치를 지원할 수 있습니다. 성능을 최적화 하려면 여러 디스크를 단일 가상 SCSI 컨트롤러에 연결 하 고 가상 컴퓨터에 연결 된 디스크의 수를 조정 하는 데 필요한 만큼 추가 컨트롤러를 만드는 것이 좋습니다. SCSI 경로는 에뮬레이션 되지 않으므로 운영 체제 디스크가 아닌 다른 모든 디스크의 기본 컨트롤러로 사용 됩니다. 실제로 2 세대 Vm은 가능한 유일한 컨트롤러 유형입니다. Windows Server 2012 r 2에서 도입 된이 컨트롤러는 공유 VHDX를 지원 하기 위해 SAS로 보고 됩니다.

## <a name="virtual-fibre-channel-hbas"></a>가상 파이버 채널 Hba

가상 파이버 채널 Hba는 가상 파이버 채널 파이버 채널 컴퓨터에 대 한 직접 액세스를 허용 하도록 구성할 수 있습니다. 가상 파이버 채널 디스크는 루트 파티션에서 NTFS 파일 시스템을 우회 하 여 저장소 i/o의 CPU 사용량을 줄입니다.

여러 가상 컴퓨터 간에 공유 되는 대량 데이터 드라이브 및 드라이브 (게스트 클러스터링 시나리오의 경우)는 가상 파이버 채널 디스크에 대 한 주요 후보입니다.

가상 파이버 채널 디스크에는 호스트에 하나 이상의 파이버 채널 Hba (호스트 버스 어댑터)를 설치 해야 합니다. 각 호스트 HBA는 Windows Server 2016 Virtual 파이버 채널/NPIV 기능을 지 원하는 HBA 드라이버를 사용 하는 데 필요 합니다. SAN 패브릭을 NPIV를 지원 해야 하 고, 가상 파이버 채널에 사용 되는 HBA 포트는 NPIV를 지 원하는 파이버 채널 토폴로지에서 설정 해야 합니다.

둘 이상의 HBA를 사용 하 여 설치 된 호스트에서 처리량을 최대화 하려면 Hyper-v 가상 컴퓨터 내에서 여러 가상 Hba를 구성 하는 것이 좋습니다 (각 가상 컴퓨터에 대해 최대 4 개의 Hba를 구성할 수 있음). Hyper-v는 동일한 가상 SAN에 액세스 하는 Hba를 호스트 하는 가상 Hba의 균형을 유지 하기 위해 자동으로 최상의 노력을 합니다.

## <a name="virtual-disks"></a>가상 디스크

가상 컨트롤러를 통해 가상 컴퓨터에 디스크를 노출할 수 있습니다. 이러한 디스크는 호스트의 디스크 또는 통과 디스크의 파일 추상화 인 가상 하드 디스크 일 수 있습니다.

## <a name="virtual-hard-disks"></a>가상 하드 디스크

VHD 및 VHDX의 두 가지 가상 하드 디스크 형식이 있습니다. 이러한 각 형식은 세 가지 유형의 가상 하드 디스크 파일을 지원 합니다.

## <a name="vhd-format"></a>VHD 형식

VHD 형식은 이전 릴리스의 Hyper-v에서 지 원하는 유일한 가상 하드 디스크 형식입니다. Windows Server 2012에 도입 된 VHD 형식은 더 나은 맞춤을 허용 하도록 수정 되었으므로 새 큰 섹터 디스크에서 성능이 크게 향상 됩니다.

Windows Server 2012 이상에서 만든 모든 새 VHD에는 최적의 4kb 맞춤이 있습니다. 이 정렬 된 형식은 이전 Windows Server 운영 체제와 완전히 호환 됩니다. 그러나 맞춤 속성은 4kb 맞춤이 인식 되지 않는 파서의 새 할당 (예: 이전 버전의 Windows Server 또는 타사 파서의 VHD 파서)에 대해 중단 됩니다.

이전 릴리스에서 이동한 모든 VHD는이 새로운 향상 된 VHD 형식으로 자동으로 변환 되지 않습니다.

새 VHD 형식으로 변환 하려면 다음 Windows PowerShell 명령을 실행 합니다.

``` syntax
Convert-VHD –Path E:\vms\testvhd\test.vhd –DestinationPath E:\vms\testvhd\test-converted.vhd
```

시스템의 모든 Vhd에 대 한 맞춤 속성을 확인할 수 있습니다 .이 속성은 최적 4kb 맞춤으로 변환 되어야 합니다. 원본 **에서 만들기-원본** 옵션을 사용 하 여 원래 vhd의 데이터로 새 vhd를 만듭니다.

Windows Powershell을 사용 하 여 맞춤을 확인 하려면 아래와 같이 맞춤 줄을 검토 합니다.

``` syntax
Get-VHD –Path E:\vms\testvhd\test.vhd

Path                    : E:\vms\testvhd\test.vhd
VhdFormat               : VHD
VhdType                 : Dynamic
FileSize                : 69245440
Size                    : 10737418240
MinimumSize             : 10735321088
LogicalSectorSize       : 512
PhysicalSectorSize      : 512
BlockSize               : 2097152
ParentPath              :
FragmentationPercentage : 10
Alignment               : 0
Attached                : False
DiskNumber              :
IsDeleted               : False
Number                  :
```

Windows PowerShell을 사용 하 여 맞춤을 확인 하려면 아래와 같이 맞춤 줄을 검토 합니다.

``` syntax
Get-VHD –Path E:\vms\testvhd\test-converted.vhd

Path                    : E:\vms\testvhd\test-converted.vhd
VhdFormat               : VHD
VhdType                 : Dynamic
FileSize                : 69369856
Size                    : 10737418240
MinimumSize             : 10735321088
LogicalSectorSize       : 512
PhysicalSectorSize      : 512
BlockSize               : 2097152
ParentPath              :
FragmentationPercentage : 0
Alignment               : 1
Attached                : False
DiskNumber              :
IsDeleted               : False
Number                  :
```

## <a name="vhdx-format"></a>VHDX 형식

VHDX는 Windows Server 2012에 도입 된 새로운 가상 하드 디스크 형식으로, 복원 력이 뛰어난 고성능 가상 디스크를 최대 64 테라바이트까지 만들 수 있습니다. 이 형식의 이점은 다음과 같습니다.

-   최대 64 tb의 가상 하드 디스크 저장소 용량 지원.

-   VHDX 메타데이터 구조에 업데이트를 기록하여 정전 시 데이터 손상으로부터 보호

-   운영 체제 버전이 나 적용 된 패치와 같이 사용자가 기록 하려는 파일에 대 한 사용자 지정 메타 데이터를 저장 하는 기능입니다.

VHDX 형식은 다음과 같은 성능상의 이점도 제공 합니다.

-   대규모 섹터 디스크에서 제대로 작동하도록 가상 하드 디스크 형식의 정렬 개선

-   동적 및 차등 디스크의 블록 크기가 크므로 이러한 디스크를 워크 로드의 요구에 맞출 수 있습니다.

-   4kb 섹터 용으로 설계 된 응용 프로그램 및 워크 로드에서 사용 하는 경우 성능을 향상 시킬 수 있는 4kb 논리 섹터 가상 디스크입니다.

-   데이터를 나타내는 효율성-파일 크기가 작고 기본 물리적 저장 장치에서 사용 하지 않는 공간을 회수할 수 있습니다. Trim을 사용 하려면 통과 또는 SCSI 디스크와 트림 호환 하드웨어가 필요 합니다.

Windows Server 2016로 업그레이드 하는 경우 이러한 이점이 있으므로 모든 VHD 파일을 VHDX 형식으로 변환 하는 것이 좋습니다. VHD 형식으로 파일을 유지 하는 것이 적합 한 유일한 시나리오는 가상 컴퓨터에서 VHDX 형식을 지원 하지 않는 이전 버전의 Hyper-v로 이동 될 가능성이 있는 경우입니다.

## <a name="types-of-virtual-hard-disk-files"></a>가상 하드 디스크 파일 유형

VHD 파일에는 세 가지 유형이 있습니다. 다음 섹션에서는 형식 간의 성능 특징 및 장단점을 설명 합니다.

VHD 파일 형식을 선택 하는 것과 관련 하 여 다음과 같은 권장 사항을 고려해 야 합니다.

-   VHD 형식을 사용할 때는 다른 VHD 파일 형식과 비교 하 여 더 나은 복원 력과 성능 특성을 제공 하므로 고정 유형을 사용 하는 것이 좋습니다.

-   VHDX 형식을 사용 하는 경우에는이 작업을 수행 해야 하는 경우에만 공간을 할당 하는 것과 관련 된 공간 절약을 위해 복원 력을 보장 하기 때문에 동적 유형을 사용 하는 것이 좋습니다.

-   런타임에 VHD 파일을 확장할 때 충분 한 디스크 공간이 확보 되도록 호스팅 볼륨의 저장소를 적극적으로 모니터링 하지 않는 경우에는 형식에 관계 없이 고정 형식을 권장 합니다.

-   가상 컴퓨터의 스냅숏은 디스크에 쓰기를 저장 하는 차이점 보관용 VHD를 만듭니다. 스냅숏이 몇 개만 있으면 저장소 i/o의 CPU 사용량을 높일 수 있지만 i/o 집약적 서버 워크 로드를 제외 하 고 성능에 크게 영향을 주지 않을 수 있습니다. 그러나 VHD를 읽으면 많은 차이점 보관용 Vhd에서 요청 된 블록을 확인 해야 할 수 있으므로 스냅숏이 큰 경우에는 성능에 큰 영향을 줄 수 있습니다. 적절 한 디스크 i/o 성능을 유지 하기 위해 스냅숏 체인을 짧게 유지 하는 것이 중요 합니다.

## <a name="fixed-virtual-hard-disk-type"></a>고정 가상 하드 디스크 유형

Vhd 파일을 만들 때 VHD의 공간이 먼저 할당 됩니다. 이 유형의 VHD 파일은 조각화 될 가능성이 낮지만 단일 i/o가 여러 i/o로 분할 된 경우 i/o 처리량을 줄입니다. 읽기 및 쓰기는 블록의 매핑을 조회할 필요가 없기 때문에 세 개의 VHD 파일 형식에 대 한 CPU 오버 헤드가 가장 낮습니다.

## <a name="dynamic-virtual-hard-disk-type"></a>동적 가상 하드 디스크 유형

VHD 공간은 요청 시 할당 됩니다. 디스크의 블록은 할당 되지 않은 블록으로 시작 되며 파일의 실제 공간에 의해 지원 되지 않습니다. 블록을에 처음 쓸 때 가상화 스택은 블록에 대 한 VHD 파일 내에 공간을 할당 한 다음 메타 데이터를 업데이트 해야 합니다. 이렇게 하면 쓰기에 필요한 디스크 i/o 수가 늘어나고 CPU 사용량이 늘어납니다. 메타 데이터에서 블록의 매핑을 조회할 때 기존 블록에 대 한 읽기 및 쓰기는 디스크 액세스 및 CPU 오버 헤드를 초래 합니다.

## <a name="differencing-virtual-hard-disk-type"></a>차이점 보관용 가상 하드 디스크 유형

VHD는 부모 VHD 파일을 가리킵니다. 블록에 쓰지 않으면 동적으로 확장 되는 VHD와 마찬가지로 VHD 파일에 공간이 할당 됩니다. 블록을에 쓴 경우에는 VHD 파일에서 읽기를 처리 합니다. 그렇지 않으면 부모 VHD 파일에서 처리 됩니다. 두 경우 모두 메타 데이터를 읽어서 블록의 매핑을 결정 합니다. 이 VHD에 대 한 읽기 및 쓰기는 더 많은 CPU를 사용 하 고 고정 VHD 파일 보다 많은 i/o를 발생 시킬 수 있습니다.

## <a name="block-size-considerations"></a>블록 크기 고려 사항

블록 크기는 성능에 상당한 영향을 줄 수 있습니다. 블록 크기를 디스크를 사용 하는 작업의 할당 패턴과 일치 시키는 것이 가장 좋습니다. 예를 들어 응용 프로그램이 16mb의 청크를 할당 하는 경우 가상 하드 디스크 블록 크기를 16mb로 하는 것이 가장 좋습니다. 크기 2mb의 블록 크기는 &gt; VHDX 형식의 가상 하드 디스크에만 가능 합니다. 임의 i/o 작업에 대 한 할당 패턴 보다 더 큰 블록 크기를 사용 하면 호스트의 공간 사용량이 크게 증가 합니다.

## <a name="sector-size-implications"></a>섹터 크기 영향

대부분의 소프트웨어 업계는 512 바이트의 디스크 섹터에 의존 하지만 표준는 4kb 디스크 섹터로 이동 합니다. 섹터 크기의 변경으로 인해 발생할 수 있는 호환성 문제를 줄이기 위해 하드 드라이브 공급 업체는 512e (512 에뮬레이션 드라이브) 라고 하는 전환 크기를 소개 합니다.

이러한 에뮬레이션 드라이브는 향상 된 형식 효율성 및 ECC (오류 수정 코드)의 향상 된 스키마와 같은 4kb 디스크 섹터 기본 드라이브에서 제공 하는 몇 가지 이점을 제공 합니다. 디스크 인터페이스에서 4kb 섹터 크기를 노출 하 여 발생 하는 호환성 문제가 줄어듭니다.

## <a name="support-for-512e-disks"></a>512e 디스크 지원

512e 디스크는 실제 섹터를 기준 으로만 쓰기를 수행할 수 있습니다. 즉, 발급 되는 512e 섹터를 직접 쓸 수는 없습니다. 이러한 쓰기를 가능 하 게 하는 디스크의 내부 프로세스는 다음 단계를 따릅니다.

-   디스크는 쓰기에서 참조 되는 512 바이트 논리 섹터를 포함 하는 4kb의 물리적 섹터를 내부 캐시로 읽어옵니다.

-   4KB 버퍼에 있는 데이터는 업데이트된 512바이트 섹터를 포함하도록 수정됩니다.

-   디스크는 다시 디스크의 해당 물리적 섹터에 업데이트된 4KB 버퍼 쓰기를 수행합니다.

이 프로세스를 RMW (읽기-수정-쓰기) 라고 합니다. RMW 프로세스의 전반적인 성능 영향은 워크 로드에 따라 달라 집니다. RMW 프로세스를 수행 하면 다음과 같은 이유로 가상 하드 디스크의 성능이 저하 됩니다.

-   동적 및 차이점 보관용 가상 하드 디스크에는 데이터 페이로드 앞에 512 바이트 섹터 비트맵이 있습니다. 또한 바닥글, 헤더 및 부모 로케이터는 512 바이트 섹터에 정렬 됩니다. 일반적으로 가상 하드 디스크 드라이버는 이러한 구조를 업데이트 하기 위해 512 바이트 쓰기 명령을 실행 하 여 앞에서 설명한 RMW 프로세스를 실행 합니다.

-   응용 프로그램은 일반적으로 4kb 크기 (NTFS의 기본 클러스터 크기)의 배수로 읽기 및 쓰기를 발급 합니다. 동적 및 차이점 보관용 가상 하드 디스크의 데이터 페이로드 블록 앞에 512 바이트 섹터 비트맵이 있으므로 4kb 블록은 물리적 4kb 경계에 정렬 되지 않습니다. 다음 그림에서는 실제 4kb 경계에 정렬 되지 않은 VHD 4kb 블록 (강조 표시 됨)을 보여 줍니다.

![vhd 4kb 블록](../../media/perftune-guide-vhd-4kb-block.png)

페이로드 데이터를 업데이트 하기 위해 현재 파서에서 발급 한 각 4kb 쓰기 명령은 디스크의 두 블록에 대해 두 개의 읽기를 발생 합니다. 그러면이는 업데이트 된 후 두 개의 디스크 블록에 다시 기록 됩니다. Windows Server 2016의 hyper-v는 VHD 형식으로 4kb 경계에 정렬 하기 위해 앞에서 언급 한 구조를 준비 하 여 VHD 스택의 512e 디스크에 대 한 일부 성능 효과를 완화 합니다. 이는 가상 하드 디스크 파일 내의 데이터에 액세스 하는 경우와 가상 하드 디스크 메타 데이터 구조를 업데이트할 때 RMW 효과를 방지 합니다.

앞서 언급 했 듯이, 이전 버전의 Windows Server에서 복사 된 Vhd는 자동으로 4kb로 정렬 되지 않습니다. VHD 인터페이스에서 사용할 수 있는 **원본 디스크에서 복사** 옵션을 사용 하 여 최적으로 정렬 되도록 수동으로 변환할 수 있습니다.

기본적으로 Vhd는 512 바이트의 물리적 섹터 크기를 사용 하 여 노출 됩니다. 이 작업은 응용 프로그램 및 Vhd가 이전 버전의 Windows Server에서 이동할 때 실제 섹터 크기 종속 응용 프로그램이 영향을 받지 않도록 하기 위한 것입니다.

기본적으로 VHDX 형식의 디스크는 성능 프로필 일반 디스크 및 큰 섹터 디스크를 최적화 하기 위해 4kb의 물리적 섹터 크기를 사용 하 여 생성 됩니다. 4kb 섹터를 모두 사용 하려면 VHDX 형식을 사용 하는 것이 좋습니다.

## <a name="support-for-native-4kb-disks"></a>기본 4kb 디스크 지원

Windows Server 2012 R2 이상에서 hyper-v는 4kb의 기본 디스크를 지원 합니다. 하지만 VHD 디스크를 4kb의 기본 디스크에 저장할 수도 있습니다. 이 작업은 512 바이트 액세스 및 업데이트 요청을 해당 4kb 액세스 및 업데이트로 변환 하는 가상 저장소 스택 계층에서 소프트웨어 RMW 알고리즘을 구현 하 여 수행 됩니다.

VHD 파일은 유일 하 게 512 바이트 논리 섹터 크기 디스크로만 노출할 수 있기 때문에 512 바이트 i/o 요청을 실행 하는 응용 프로그램이 있을 가능성이 매우 높습니다. 이러한 경우 RMW 계층은 이러한 요청을 충족 하 고 성능 저하를 발생 시킵니다. 이는 논리 섹터 크기가 512 바이트인 VHDX로 포맷 된 디스크의 경우에도 마찬가지입니다.

VHDX 파일이 4kb 논리 섹터 크기 디스크로 노출 되도록 구성할 수 있습니다 .이는 디스크가 4kb 기본 물리적 장치에서 호스트 되는 경우 최적의 성능을 위해 구성 될 수 있습니다. 가상 디스크를 사용 하는 게스트 및 응용 프로그램이 4kb 논리 섹터 크기로 지원 되는지 확인 해야 합니다. VHDX 서식 지정은 4kb 논리 섹터 크기 장치에서 제대로 작동 합니다.

## <a name="pass-through-disks"></a>통과 디스크

가상 컴퓨터의 VHD를 VHD 파일 대신 실제 디스크 또는 LUN (논리 단위 번호)에 직접 매핑할 수 있습니다. 이 구성은 루트 파티션에서 NTFS 파일 시스템을 우회 하 여 저장소 i/o의 CPU 사용량을 줄이는 것이 좋습니다. 실제 디스크 또는 Lun은 VHD 파일 보다 컴퓨터 간에 이동 하기가 더 어려울 수 있습니다.

통과 디스크는 가상 컴퓨터 마이그레이션 시나리오에 도입 된 제한 사항 때문에 피해 야 합니다.

## <a name="advanced-storage-features"></a>고급 저장소 기능

### <a name="storage-quality-of-service-qos"></a>스토리지 서비스 품질(QoS)

Windows Server 2012 R2부터 Hyper-v에는 가상 컴퓨터의 저장소에 대 한 특정 QoS (서비스 품질) 매개 변수를 설정 하는 기능이 포함 되어 있습니다. 스토리지 QoS는 스토리지 I/O 성능이 가상 머신 워크로드를 효율적으로 실행하도록 정의된 임계값을 충족하지 않는 경우 이를 알리는 메커니즘과 다중 테넌트 환경에서 스토리지 성능을 격리하는 기능을 제공합니다.

스토리지 QoS는 가상 하드 디스크에 대한 최대 IOPS(초당 입/출력 작업 수) 값을 지정할 수 있는 기능을 제공합니다. 관리자는 스토리지 I/O를 조절하여 테넌트가 다른 테넌트에 영향을 줄 수 있을 정도로 과도한 스토리지 리소스를 사용하는 것을 중지할 수 있습니다.

최소 IOPS 값을 설정할 수도 있습니다. 이 값은 지정된 가상 하드 디스크의 IOPS가 최적 성능에 필요한 임계값에 미달하는 경우 이를 알립니다.

관리자가 성능 및 차지백 관련 매개 변수를 모니터링할 수 있는 스토리지 관련 매개 변수를 통해 가상 머신 메트릭 인프라도 업데이트됩니다.

최대 및 최소 값은 모든 8kb의 데이터가 i/o로 계산 되는 정규화 된 IOPS를 기준으로 지정 됩니다.

몇 가지 제한 사항은 다음과 같습니다.

-   가상 디스크에만 해당

-   차이점 보관용 디스크에는 다른 볼륨의 부모 가상 디스크를 사용할 수 없습니다.

-   복제본-기본 사이트와 별도로 구성 된 복제본 사이트의 QoS

-   공유 VHDX는 지원 되지 않습니다.

저장소 서비스 품질에 대 한 자세한 내용은 [hyper-v에 대 한 저장소 서비스 품질](https://technet.microsoft.com/library/dn282281.aspx)을 참조 하세요.

### <a name="numa-io"></a>NUMA I/O

Windows Server 2012 이상에서는 큰 가상 컴퓨터를 지원 하 고, 큰 가상 컴퓨터 구성 (예: 64 가상 프로세서를 사용 하 여 Microsoft SQL Server를 실행 하는 구성)에는 i/o 처리량 측면에서 확장성이 필요 합니다.

Windows Server 2012 저장소 스택에 처음 도입 된 다음 주요 개선 사항 및 Hyper-v는 대규모 가상 컴퓨터의 i/o 확장성 요구를 제공 합니다.

-   게스트 장치와 호스트 저장소 스택 간에 생성 되는 통신 채널 수가 증가 합니다.

-   과도 한 프로세서 중단을 방지 하기 위해 가상 프로세서 간의 인터럽트 배포를 포함 하는 보다 효율적인 i/o 완료 메커니즘입니다.

Windows Server 2012에 도입 된 몇 가지 레지스트리 항목은 HKLM \\ System \\ CurrentControlSet \\ Enum \\ VMBUS \\ {device id} \\ {instance id} storchannel에 있으며 \\ 채널 수를 조정할 수 있습니다. I/o 프로세서를 처리 하는 가상 Cpu를 응용 프로그램에서 할당 하는 가상 Cpu에 맞게 조정 합니다. 레지스트리 설정은 장치의 하드웨어 키에서 어댑터 별로 구성 됩니다.

-   **Channelcount (DWORD)** 사용할 총 채널 수 이며 최대 16 개입니다. 기본값은 가상 프로세서 수/16의 상한입니다.

-   **Channelmask (qword(64)** 채널에 대 한 프로세서 선호도입니다. 설정 되지 않았거나 0으로 설정 된 경우 기본 저장소 또는 네트워킹 채널에 사용 하는 기존 채널 배포 알고리즘으로 기본 설정 됩니다. 이렇게 하면 저장소 채널이 네트워크 채널과 충돌 하지 않습니다.

### <a name="offloaded-data-transfer-integration"></a>오프 로드 된 데이터 전송 통합

Vhd에 대 한 중요 한 유지 관리 작업 (예: 병합, 이동 및 압축)은 많은 양의 데이터를 복사 하는 데 따라 다릅니다. 현재의 데이터 복사 방법에서는 데이터를 읽고 다른 위치에 써야 하며 이러한 작업은 시간이 많이 소요될 수 있습니다. 또한 가상 컴퓨터를 서비스 하는 데 사용 될 수 있는 호스트에서 CPU 및 메모리 리소스를 사용 합니다.

SAN(스토리지 영역 네트워크) 공급업체는 대량의 데이터를 거의 즉시 복사하는 기능을 제공하기 위해 최선을 다하고 있습니다. 이 저장소는 디스크 위에 있는 시스템이 특정 위치에서 다른 위치로의 특정 데이터 집합 이동을 지정할 수 있도록 설계 되었습니다. 이 하드웨어 기능을 오프 로드 된 데이터 전송 이라고 합니다.

Windows Server 2012 이상에서 hyper-v는 이러한 작업을 게스트 운영 체제에서 호스트 하드웨어에 전달할 수 있도록 ODX (오프 로드 데이터 전송) 작업을 지원 합니다. 이렇게 하면 가상화 되지 않은 환경에서 실행 되는 것 처럼 작업에서 ODX 지원 저장소를 사용할 수 있습니다. 또한 Hyper-v 저장소 스택은 디스크 병합 및 저장소 마이그레이션 메타-작업 (예: 많은 양의 데이터가 이동 되는 경우)에 대 한 유지 관리 작업을 수행 하는 동안 ODX 작업을 발생 시킵니다.

### <a name="unmap-integration"></a>통합 매핑 해제

가상 하드 디스크 파일은 저장소 볼륨의 파일로 존재 하 고 사용 가능한 공간을 다른 파일과 공유 합니다. 이러한 파일의 크기는 매우 크기 때문에 사용 하는 공간이 빠르게 증가할 수 있습니다. 물리적 저장소에 대 한 수요는 IT 하드웨어 예산에 영향을 줍니다. 가능한 한 물리적 저장소 사용을 최적화 하는 것이 중요 합니다.

Windows Server 2012 이전에는 응용 프로그램이 콘텐츠 저장소 공간을 효과적으로 중단 한 가상 하드 디스크 내에서 콘텐츠를 삭제 하는 경우 게스트 운영 체제 및 Hyper-v 호스트의 Windows 저장소 스택에는이 정보가 가상 하드 디스크 및 물리적 저장 장치에 전달 되지 못하도록 하는 제한 사항이 있었습니다. 이로 인해 Hyper-v 저장소 스택은 VHD 기반 가상 디스크 파일에의 한 공간 사용을 최적화 하지 못했습니다. 또한 기본 저장 장치에서 이전에 삭제 된 데이터에 의해 점유 된 공간을 회수 하지 못하도록 합니다.

Windows Server 2012부터 Hyper-v는 해당 데이터를 표현 하는 데 VHDX 파일의 효율성을 높일 수 있는 매핑 해제 알림을 지원 합니다. 이로 인해 파일 크기가 작을수록 기본 물리적 저장 장치에서 사용 하지 않는 공간을 회수할 수 있습니다.

Hyper-v 관련 SCSI, 지원 IDE 및 가상 파이버 채널 컨트롤러만 있으면 게스트의 매핑 해제 명령이 호스트 가상 저장소 스택에 도달할 수 있습니다. 가상 하드 디스크에서는 VHDX로 포맷 된 가상 디스크만 게스트에서 명령을 매핑 해제 하도록 지원 합니다.

이러한 이유로 가상 파이버 채널 디스크를 사용 하지 않는 경우 SCSI 컨트롤러에 연결 된 VHDX 파일을 사용 하는 것이 좋습니다.

## <a name="additional-references"></a>추가 참조

-   [Hyper-V 용어](terminology.md)

-   [Hyper-V 아키텍처](architecture.md)

-   [Hyper-V 서버 구성](configuration.md)

-   [Hyper-V 프로세서 성능](processor-performance.md)

-   [Hyper-V 메모리 성능](memory-performance.md)

-   [Hyper-V 네트워크 I/O 성능](network-io-performance.md)

-   [가상화된 환경의 병목 상태 탐지](detecting-virtualized-environment-bottlenecks.md)

-   [Linux Virtual Machines](linux-virtual-machine-considerations.md)
